(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     88785,       1987]
NotebookOptionsPosition[     84367,       1915]
NotebookOutlinePosition[     84860,       1933]
CellTagsIndexPosition[     84817,       1930]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Virtual Device and questlink", "Section",
 CellChangeTimes->{{3.867828173808653*^9, 
  3.867828181020499*^9}},ExpressionUUID->"e5abd4bc-7410-43a7-b0e4-\
f4a71b06d082"],

Cell[BoxData[
 RowBox[{"SetEnvironment", "[", 
  RowBox[{"\"\<OMP_NUM_THREADS\>\"", "\[Rule]", "\"\<8\>\""}], "]"}]], "Input",\

 CellLabel->
  "In[216]:=",ExpressionUUID->"9c142616-efba-4462-b026-531604d75a29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 CellLabel->
  "In[217]:=",ExpressionUUID->"7164f137-e180-411b-9f7c-f6c32df31320"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "Import", "[", "\"\</home/cica/programs/QuESTlink/Link/QuESTlink.m\>\"", 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateLocalQuESTEnv", "[", "\"\<quest_link_cpu\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.82497505062926*^9, 3.8249750506297073`*^9}, 
   3.824994043627574*^9, 3.825001607792643*^9, {3.825001692867886*^9, 
   3.825001693910748*^9}, 3.825005541672139*^9, {3.8257703632332573`*^9, 
   3.8257703928999557`*^9}, {3.8257705549908867`*^9, 
   3.8257705572226887`*^9}, {3.827395402084569*^9, 3.827395414565299*^9}, 
   3.8273959879208593`*^9, {3.8273960394479303`*^9, 3.8273960853619223`*^9}, {
   3.8273961168062162`*^9, 3.827396123715522*^9}, {3.827396318549856*^9, 
   3.827396412632536*^9}, {3.8274045827011538`*^9, 3.82740458379325*^9}, {
   3.8278173564819393`*^9, 3.827817361228321*^9}, {3.830976734134877*^9, 
   3.8309767494625072`*^9}, {3.834480282684927*^9, 3.834480283538302*^9}, {
   3.834480426528635*^9, 3.834480438344689*^9}, {3.840643429673587*^9, 
   3.84064343214264*^9}, {3.840644090065632*^9, 3.840644110294639*^9}, {
   3.841376639126837*^9, 3.841376652890356*^9}, {3.852805051225027*^9, 
   3.852805051940732*^9}, 3.852866941489101*^9, 3.863433244574464*^9, {
   3.863444417946168*^9, 3.8634444207524557`*^9}, {3.863758485466724*^9, 
   3.8637585009226294`*^9}, {3.863763334072833*^9, 3.8637633356047773`*^9}},
 CellLabel->
  "In[218]:=",ExpressionUUID->"bdc5fccf-12ea-488c-ae86-ace93b7013bd"],

Cell[BoxData[
 RowBox[{"Get", "[", "\"\<../vqd.wl\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.840641143565943*^9, 3.840641172251192*^9}, {
   3.852799583306651*^9, 3.85279959973236*^9}, 3.8626416092550993`*^9, {
   3.8634335183180933`*^9, 3.863433525482596*^9}, {3.863433568660131*^9, 
   3.863433569874107*^9}, {3.863433692497489*^9, 3.863433694465293*^9}, {
   3.863445057138888*^9, 3.86344507880478*^9}, {3.863445347209435*^9, 
   3.8634453507921267`*^9}, {3.863445650432852*^9, 3.863445652815689*^9}, {
   3.863445897019453*^9, 3.8634458974688377`*^9}, {3.86344607759472*^9, 
   3.863446078099331*^9}, {3.863446143635272*^9, 3.863446143966124*^9}, {
   3.863446177367778*^9, 3.86344617796842*^9}, {3.8634467623389387`*^9, 
   3.863446816486045*^9}, {3.863446923713131*^9, 3.863446924990855*^9}, {
   3.863447604132453*^9, 3.8634476320572042`*^9}, {3.863448157317191*^9, 
   3.863448185412036*^9}, {3.86344848550739*^9, 3.863448486307929*^9}, {
   3.863730635263914*^9, 3.863730645543404*^9}, {3.863730806825498*^9, 
   3.863730825085904*^9}, {3.864798306500605*^9, 3.864798308030095*^9}, {
   3.864808339041327*^9, 3.864808339281568*^9}},
 CellLabel->
  "In[220]:=",ExpressionUUID->"e6fc824d-13a0-4e4f-8d13-9693c655ca12"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "SiliconDelft", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"qubitsNum", "->", "6"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"average", " ", "of", " ", "T1"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"T1", "->", 
      SuperscriptBox["10", "4"]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"T2", " ", "obtained", " ", "by", " ", "echo", " ", 
         RowBox[{"RX", "[", 
          RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "-", "\[Tau]", "-", 
        RowBox[{"RX", "[", "\[Pi]", "]"}], "-", "\[Tau]", "-", 
        RowBox[{"RX", "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], ",", " ", 
       RowBox[{
        RowBox[{"where", " ", "\[Tau]"}], "=", 
        RowBox[{"1", 
         RowBox[{"\[Mu]s", ".", " ", "We"}], " ", "assume", " ", "the", " ", 
         "T2", "*", " ", "is", " ", "echoed", " ", "out", " ", "to", " ", 
         "T2"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"T2", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "14"}], ",", 
        RowBox[{"1", "->", " ", "21.1"}], ",", 
        RowBox[{"2", "->", " ", "40.1"}], ",", 
        RowBox[{"3", "->", " ", "37.2"}], ",", 
        RowBox[{"4", "->", " ", "44.7"}], ",", 
        RowBox[{"5", "->", " ", "26.7"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"EDIT", ":", " ", 
       RowBox[{
       "Qubit", " ", "frequency", " ", "of", " ", "each", " ", "qubit", " ", 
        "in", " ", "MHz"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"QubitFreq", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", 
         RowBox[{"15.62", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"1", "->", " ", 
         RowBox[{"15.88", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"2", "->", " ", 
         RowBox[{"16.3", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"3", "->", " ", 
         RowBox[{"16.1", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"4", "->", " ", 
         RowBox[{"15.9", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"5", "->", " ", 
         RowBox[{"15.69", "*", 
          SuperscriptBox["10", "3"]}]}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"rabi", " ", "frequencies", " ", "on", " ", "single", " ", 
       RowBox[{"rotations", ":", " ", 
        RowBox[{"5", " ", "is", " ", "average"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"RabiFreq", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "5"}], ",", 
        RowBox[{"1", "->", "5"}], ",", 
        RowBox[{"2", "->", "5"}], ",", 
        RowBox[{"3", "->", "5"}], ",", 
        RowBox[{"4", "->", "5"}], ",", 
        RowBox[{"5", "->", "5"}]}], "|>"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Set", " ", "the", " ", "noise", " ", "form", " ", "of", " ", "off"}], 
       "-", 
       RowBox[{"resonant", " ", "Rabi", " ", 
        RowBox[{"oscillation", ".", " ", "This"}], " ", "takes", " ", 
        "RabiFreq", " ", "information", " ", "to", " ", "produce", " ", "the",
         " ", 
        RowBox[{"noise", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"OffResonantRabi", "->", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Set", " ", "the", " ", "standard", " ", "depolarising", " ", "and", 
       " ", "dephasing", " ", "passive", " ", "noise", " ", "using", " ", 
       "T1", " ", "and", " ", 
       RowBox[{"T2", "/", "T2s"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"StdPassiveNoise", "->", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Fidelities", " ", "of", " ", "X"}], "-", " ", 
       RowBox[{"and", " ", "Y"}], "-", " ", 
       RowBox[{"rotations", " ", "by", " ", "random", " ", "benchmarking"}]}],
       " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FidSingleXY", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "0.9977"}], ",", 
        RowBox[{"1", "->", " ", "0.9987"}], ",", 
        RowBox[{"2", "->", " ", "0.9996"}], ",", 
        RowBox[{"3", "->", " ", "0.9988"}], ",", 
        RowBox[{"4", "->", " ", "0.9991"}], ",", 
        RowBox[{"5", "->", " ", "0.9989"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Error", " ", 
       RowBox[{"fraction", "/", "ratio"}], " ", 
       RowBox[{"{", 
        RowBox[{"depolarising", ",", " ", "dephasing"}], "}"}], " ", "sum", 
       " ", "is", " ", "either", " ", "one", " ", "or", " ", "zero"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"EFSingleXY", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", "  ", 
      RowBox[{
       RowBox[{
        RowBox[{"The", " ", "rabi", " ", "Frequency", " ", 
         RowBox[{"(", "MHz", ")"}], " ", "and", " ", "fidelities", " ", "of", 
         " ", "controlled"}], "-", "Z"}], ",", " ", 
       RowBox[{"C", "[", "Z", "]"}], ",", " ", 
       RowBox[{"nearest", "-", 
        RowBox[{
         RowBox[{"neighbors", ".", " ", "Keys"}], " ", "are", " ", "the", " ",
          "smallest", " ", "qubit", " ", 
         RowBox[{"number", ".", " ", "This"}], " ", "applies", " ", "to", " ", 
         RowBox[{"C", "[", "Ph", "]"}], " ", "gates"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"FreqCZ", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "12.1"}], ",", 
        RowBox[{"1", "->", " ", "11.1"}], ",", 
        RowBox[{"2", "->", " ", "6.6"}], ",", 
        RowBox[{"3", "->", " ", "9.8"}], ",", 
        RowBox[{"4", "->", " ", "5.4"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "obtained", " ", "from", " ", "a", " ", "simple", " ", "optimisation", 
       " ", "via", " ", "bell", " ", "state", " ", "fidelity"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"FidCZ", "->", 
      RowBox[{"\[LeftAssociation]", 
       RowBox[{
        RowBox[{"0", "\[Rule]", "0.9239537120590723`"}], ",", 
        RowBox[{"1", "\[Rule]", "0.9241761025557745`"}], ",", 
        RowBox[{"2", "\[Rule]", "0.9166807085341168`"}], ",", 
        RowBox[{"3", "\[Rule]", "0.9805456134451412`"}], ",", 
        RowBox[{"4", "\[Rule]", "0.9649648861853775`"}]}], 
       "\[RightAssociation]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"CROT", "/", "Controlled"}], "-", 
       RowBox[{"X", " ", "rotation"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FidCRot", "->", "0.9988"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Rabi", " ", "frequency", " ", "of", " ", "CROT", " ", "in", " ", 
        "MHz"}], ",", " ", 
       RowBox[{"conditional", " ", "microwave", " ", "drive"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"FreqCRot", "->", "5"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Error", " ", 
        RowBox[{"fraction", "/", "ratio"}], " ", 
        RowBox[{"{", 
         RowBox[{"depolarising", ",", " ", "dephasing"}], "}"}], " ", "of", 
        " ", "controled"}], "-", 
       RowBox[{"Ph", 
        RowBox[{"(", "\[Pi]", ")"}], " ", "rotation", " ", "or", " ", 
        "controlled"}], "-", 
       RowBox[{
        RowBox[{"Z", ".", " ", "The"}], " ", "error", " ", "for", " ", 
        "other", " ", "\[Theta]", " ", "is", " ", "scalled", " ", "from", " ", 
        RowBox[{"\[Pi]", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"EFCZ", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Crosstalks", " ", "error", " ", 
        RowBox[{"(", 
         RowBox[{"C", "-", 
          RowBox[{"Rz", "[", "ex", "]"}]}], ")"}], "on", " ", "the", " ", 
        "passive", " ", "qubits", " ", "when", " ", "applying", " ", "CZ", 
        " ", "gates"}], ";", 
       RowBox[{
        RowBox[{
        "square", " ", "matrix", " ", "with", " ", "dims", " ", "nqubit"}], 
        "-", "2"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ExchangeRotOn", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "0", ",", "0.023", ",", " ", "0.018", " ", ",", "0.03", ",", " ", 
          "0.04"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.05", " ", ",", "0", ",", "0.03", ",", " ", "0.03", ",", " ", 
          "0.04"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.05", ",", " ", "0.03", " ", ",", "0", ",", "0.07", ",", " ", 
          "0.042"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.038", " ", ",", "0.03", " ", ",", "0.031", ",", "0", " ", ",", 
          "0.25"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.033", ",", " ", "0.03", " ", ",", "0.02", ",", " ", "0.03", ",", 
          "0"}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Crosstalks", " ", "error", " ", 
       RowBox[{"(", 
        RowBox[{"C", "-", 
         RowBox[{"Rz", "[", "ex", "]"}]}], ")"}], "on", " ", "the", " ", 
       "passive", " ", "qubits", " ", "when", " ", "no", " ", "CZ", " ", 
       "gates", " ", "applied"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ExchangeRotOff", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "0.039"}], ",", 
        RowBox[{"1", "->", " ", "0.015"}], " ", ",", 
        RowBox[{"2", "->", "0.03"}], " ", ",", 
        RowBox[{"3", "->", "0.02"}], ",", 
        RowBox[{"4", "->", " ", "0.028"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Parity", " ", "readout", " ", 
        RowBox[{"fidelity", "/", "charge"}], " ", "readout", " ", 
        "fidelity"}], ",", " ", 
       RowBox[{
        RowBox[{"on", " ", "01", " ", "and", " ", "56.", " ", "2"}], "-", 
        RowBox[{"qubit", " ", "readout", " ", 
         RowBox[{"error", ":", " ", 
          RowBox[{"2", "-", 
           RowBox[{"qubit", " ", "bitflip"}]}]}]}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"FidRead", "->", "0.9997"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Parity", " ", "readout", " ", "duration", " ", "in", " ", "\[Mu]s"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"DurRead", "->", "10"}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.863454326576664*^9, 3.86345445086904*^9}, {
   3.863454537922344*^9, 3.863454759471093*^9}, {3.8634548456673307`*^9, 
   3.863454893238694*^9}, {3.8634550060872517`*^9, 3.863455068944643*^9}, {
   3.863455133571136*^9, 3.863455227330941*^9}, 3.863455467661772*^9, {
   3.863457164835682*^9, 3.863457167999679*^9}, {3.863466625653171*^9, 
   3.863466626534453*^9}, {3.863466656717869*^9, 3.863466703168454*^9}, {
   3.8634973211659327`*^9, 3.8634973254412003`*^9}, {3.86349739810318*^9, 
   3.863497405046731*^9}, {3.863497468564005*^9, 3.8634974835231323`*^9}, {
   3.863497865402828*^9, 3.863497937969355*^9}, {3.863498036048129*^9, 
   3.863498049295327*^9}, {3.8635054303559723`*^9, 3.863505433213793*^9}, {
   3.86350550349166*^9, 3.86350553320689*^9}, {3.8635055942440557`*^9, 
   3.863505686303484*^9}, {3.863506291528799*^9, 3.8635062968553467`*^9}, {
   3.863507204742934*^9, 3.863507205398917*^9}, {3.863507542638804*^9, 
   3.863507557917809*^9}, {3.863507943529126*^9, 3.863507976755619*^9}, {
   3.863508044958579*^9, 3.863508077212262*^9}, {3.86350890518664*^9, 
   3.863508920135289*^9}, {3.863508966728973*^9, 3.863509008780376*^9}, {
   3.86350916806068*^9, 3.8635091910245733`*^9}, {3.863509252645124*^9, 
   3.863509294736676*^9}, {3.8635093606291122`*^9, 3.8635093818916273`*^9}, {
   3.8635094652267933`*^9, 3.8635094801530046`*^9}, {3.863509592159338*^9, 
   3.8635096225429373`*^9}, {3.8635122825187902`*^9, 3.863512284570554*^9}, {
   3.863516612474678*^9, 3.8635166674884863`*^9}, {3.8635167208981028`*^9, 
   3.8635167625815563`*^9}, {3.863516823329026*^9, 3.8635169241870117`*^9}, {
   3.863516997922885*^9, 3.863517000491891*^9}, {3.863517045192436*^9, 
   3.863517066165266*^9}, 3.863517275598391*^9, {3.863517980140644*^9, 
   3.8635180038636103`*^9}, {3.863545141306963*^9, 3.863545144601259*^9}, {
   3.8635454117536716`*^9, 3.8635454140819263`*^9}, 3.863547338032958*^9, {
   3.863687152768737*^9, 3.863687173097149*^9}, {3.863688838935486*^9, 
   3.863688840892613*^9}, {3.863689282911751*^9, 3.863689315823909*^9}, {
   3.863689387898333*^9, 3.8636894121330137`*^9}, {3.863689578759942*^9, 
   3.863689581331337*^9}, 3.8636919098766613`*^9, {3.863692067181011*^9, 
   3.863692077649724*^9}, {3.863692162508729*^9, 3.863692200222268*^9}, {
   3.8636932798622427`*^9, 3.86369328878601*^9}, {3.863693614307301*^9, 
   3.8636936252782173`*^9}, {3.8636983827134*^9, 3.863698383179586*^9}, {
   3.8636984439189243`*^9, 3.863698452578929*^9}, {3.863698548560186*^9, 
   3.863698566835609*^9}, {3.863698868775147*^9, 3.8636988713380957`*^9}, {
   3.863700237685199*^9, 3.8637002389417953`*^9}, {3.8637034550869093`*^9, 
   3.8637034837088337`*^9}, {3.863704291710779*^9, 3.863704301547406*^9}, {
   3.863714520229396*^9, 3.863714530328062*^9}, {3.863714865544895*^9, 
   3.863714867559564*^9}, {3.863720844655518*^9, 3.8637208466883287`*^9}, {
   3.863723030071966*^9, 3.863723046850814*^9}, {3.86372666141252*^9, 
   3.863726684924015*^9}, {3.86372989606573*^9, 3.863729920257824*^9}, {
   3.863730000866426*^9, 3.863730061449833*^9}, {3.863730142585045*^9, 
   3.863730146333034*^9}, {3.863730273549018*^9, 3.863730277915167*^9}, {
   3.864809315364197*^9, 3.864809342435961*^9}, {3.865241896577642*^9, 
   3.865241965319664*^9}, {3.865242170995185*^9, 3.8652422163818073`*^9}, {
   3.865242586418998*^9, 3.865242645945384*^9}, {3.865301523610495*^9, 
   3.865301523804263*^9}, {3.865304595713649*^9, 3.865304630418612*^9}, {
   3.865305281127989*^9, 3.865305309602809*^9}, 3.865305588921054*^9, {
   3.865305787159018*^9, 3.86530581639502*^9}, {3.865305853260783*^9, 
   3.865305867462254*^9}, {3.865310939498365*^9, 3.865310941287299*^9}, {
   3.865311194937191*^9, 3.8653111979588823`*^9}, {3.8653143900727043`*^9, 
   3.865314454237653*^9}, {3.8653154779690933`*^9, 3.865315496838056*^9}, {
   3.865318109970881*^9, 3.86531811099685*^9}, 3.865318180928546*^9, {
   3.865318743182887*^9, 3.86531874745192*^9}, 3.865318833112453*^9, {
   3.865326490592826*^9, 3.865326494629116*^9}, {3.8653354448526373`*^9, 
   3.86533546437783*^9}, {3.8653355083434153`*^9, 3.86533557048916*^9}, {
   3.8653364322479973`*^9, 3.8653364655979757`*^9}, {3.865341484936504*^9, 
   3.8653414878495913`*^9}, 3.8653416195005007`*^9, {3.865345851123419*^9, 
   3.865345858317955*^9}, {3.865346113550395*^9, 3.865346190009326*^9}, {
   3.8653470773484173`*^9, 3.865347081495287*^9}, {3.8656707470014057`*^9, 
   3.865670796318157*^9}, {3.8656790007660303`*^9, 3.865679001323718*^9}, 
   3.8656843989423237`*^9, 3.8666160769098997`*^9, {3.866616114160323*^9, 
   3.8666162015449247`*^9}, {3.866619375120623*^9, 3.8666194336431723`*^9}, 
   3.866621122381987*^9, {3.866621590627623*^9, 3.86662159691364*^9}, {
   3.866621655249542*^9, 3.866621666883637*^9}, 3.8666222144323053`*^9, {
   3.866636067324276*^9, 3.8666360678426657`*^9}, {3.8668803882353*^9, 
   3.8668804426595716`*^9}, {3.866886228025002*^9, 3.866886228632259*^9}, {
   3.866886331468575*^9, 3.866886354812584*^9}, {3.866886483413403*^9, 
   3.866886483701168*^9}, {3.866890866868362*^9, 3.866890889128701*^9}, {
   3.86707189088066*^9, 3.867071901570595*^9}, {3.8670738873681097`*^9, 
   3.8670738876101637`*^9}, {3.867074295673387*^9, 3.867074305041202*^9}, 
   3.867078025094675*^9, 3.867081305646978*^9, {3.8670826214818277`*^9, 
   3.867082622779291*^9}, {3.867086220820739*^9, 3.867086273052486*^9}, 
   3.8670865841642027`*^9, {3.8670867191588707`*^9, 3.867086806160844*^9}, {
   3.8670869054397783`*^9, 3.867087010207574*^9}, {3.8670874390882807`*^9, 
   3.867087442064454*^9}, {3.86708800649929*^9, 3.867088006932907*^9}, {
   3.867090304711514*^9, 3.867090305162479*^9}, {3.8672286096262703`*^9, 
   3.86722864276227*^9}, {3.867389960250317*^9, 3.867389961480669*^9}, {
   3.867401335686801*^9, 3.867401336230983*^9}, {3.8677540734954567`*^9, 
   3.867754074642458*^9}, {3.867830195310774*^9, 3.8678302810795507`*^9}, {
   3.867830430817397*^9, 3.8678304360372353`*^9}, {3.86783062016473*^9, 
   3.8678306224016113`*^9}, {3.8678307198952303`*^9, 
   3.8678307226975737`*^9}, {3.8678311109554157`*^9, 3.867831118485732*^9}, {
   3.867831426795176*^9, 3.867831431991856*^9}, {3.867832315373279*^9, 
   3.8678323204096947`*^9}, {3.868007902693049*^9, 3.868007907485073*^9}, {
   3.868008287158381*^9, 3.868008291558558*^9}, 3.868009148893956*^9, {
   3.868010153313923*^9, 3.868010158310638*^9}, {3.868010220280282*^9, 
   3.868010221215962*^9}, {3.868265261193762*^9, 3.8682652718065033`*^9}, {
   3.8692134293059587`*^9, 3.869213458651064*^9}, {3.871346498706607*^9, 
   3.871346505845643*^9}, {3.87134659916821*^9, 3.871346659854102*^9}, 
   3.87144408515312*^9, {3.872607201645105*^9, 3.8726072048181543`*^9}, {
   3.873729295537819*^9, 3.8737292962954607`*^9}, {3.873730012544301*^9, 
   3.87373001339653*^9}, {3.8737324317071342`*^9, 3.873732432689148*^9}, {
   3.873733940009379*^9, 3.873733947431471*^9}, {3.8742321705271606`*^9, 
   3.874232184348835*^9}, {3.874312527424987*^9, 3.8743125847315817`*^9}, {
   3.874390034572681*^9, 3.874390078462762*^9}, 3.874390130521655*^9, {
   3.874751721988456*^9, 3.8747517259300756`*^9}, {3.8747523623054028`*^9, 
   3.874752396064756*^9}, {3.88729578036195*^9, 3.887295822265801*^9}, {
   3.88729609381609*^9, 3.8872961037325487`*^9}, {3.8872961637409897`*^9, 
   3.887296164026272*^9}, {3.8872964261682587`*^9, 3.88729647257012*^9}, {
   3.8872965041594057`*^9, 3.887296508148116*^9}, {3.887296610934127*^9, 
   3.8872966214149933`*^9}, {3.8872969694133177`*^9, 3.887296970194491*^9}, {
   3.8874597308142653`*^9, 3.887459731071867*^9}, {3.887477778759605*^9, 
   3.8874778491259127`*^9}, {3.887480658614203*^9, 3.887480700397046*^9}, {
   3.88752684588726*^9, 3.8875268542750397`*^9}, 3.887526925624063*^9, {
   3.887527374907674*^9, 3.887527386508497*^9}, {3.88752744943648*^9, 
   3.8875274507322702`*^9}},
 CellLabel->
  "In[5691]:=",ExpressionUUID->"efce63ac-2995-401f-803a-c390548e984a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simple noise parameters optimisation in VQD", "Section",
 CellChangeTimes->{{3.86740366966924*^9, 3.867403679786591*^9}, {
  3.8678299526691647`*^9, 3.867829953994721*^9}, {3.867991354651064*^9, 
  3.867991366964538*^9}, {3.868005068781521*^9, 
  3.8680050695264597`*^9}},ExpressionUUID->"ba65ad1f-db69-4b88-a423-\
9e4fb1904099"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "GradDescent", "]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"GradDescent", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GradDescent", "[", 
    RowBox[{"params_", ",", "objf_", ",", "conf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "cost", ",", "basecost", ",", "grad", ",", "paramst", ",", "paramst2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"basecost", "=", 
       RowBox[{"objf", "[", "params", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grad", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"paramst", "=", "params"}], ";", "\[IndentingNewLine]", 
          RowBox[{"paramst2", "=", "params"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"paramst", "[", "k", "]"}], "=", 
           RowBox[{"N", "[", 
            RowBox[{
             RowBox[{"paramst", "[", "k", "]"}], "+", 
             RowBox[{"conf", "[", "\"\<d\[Theta]\>\"", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"paramst2", "[", "k", "]"}], "=", 
           RowBox[{"N", "[", 
            RowBox[{
             RowBox[{"paramst", "[", "k", "]"}], "-", 
             RowBox[{"conf", "[", "\"\<d\[Theta]\>\"", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"N", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"objf", "[", "paramst", "]"}], "-", 
              RowBox[{"objf", "[", "paramst2", "]"}]}], ")"}], "*", 
            RowBox[{"0.5", "/", 
             RowBox[{"conf", "[", "\"\<d\[Theta]\>\"", "]"}]}]}], " ", 
           "]"}]}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", 
           RowBox[{"Keys", "@", "params"}]}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"UpdateCost", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UpdateCost", "[", 
    RowBox[{"params_", ",", "objf_", ",", "conf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grad", ",", " ", "beststep", ",", "gradstep", ",", "tparams", ",", 
       "cbest", ",", "cnew"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"beststep", "=", 
       RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gradstep", "=", "beststep"}], ";", "\[IndentingNewLine]", 
      RowBox[{"grad", "=", 
       RowBox[{"GradDescent", "[", 
        RowBox[{"params", ",", "objf", ",", "conf"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"tparams", "=", 
       RowBox[{"Normal", "@", "params"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tparams", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "-=", 
       RowBox[{
        RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], "*", "grad"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cbest", "=", 
       RowBox[{"objf", "[", "tparams", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"conf", "[", "\"\<gradstepmultiply\>\"", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{"True", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"gradstep", "*=", 
             RowBox[{"conf", "[", "\"\<gradstepmultiply\>\"", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"tparams", "=", 
             RowBox[{"Normal", "@", "params"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{
             RowBox[{"tparams", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "-=", 
             RowBox[{"gradstep", "*", "grad"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"cnew", "=", 
             RowBox[{"objf", "[", "tparams", "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"cnew", ">=", "cbest"}], ",", " ", 
              RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"cbest", "=", "cnew"}], ";", "\[IndentingNewLine]", 
            RowBox[{"beststep", "=", "gradstep"}]}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tparams", "=", 
       RowBox[{"Normal", "@", "params"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tparams", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "-=", 
       RowBox[{"beststep", "*", "grad"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"params", "=", 
       RowBox[{"Association", "@", "tparams"}]}], ";", "\[IndentingNewLine]", 
      "cbest"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParamsFit", "::", "usage"}], "=", 
   "\"\<ParamsFit[device, conf]. Parameterisation fitting.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"ParamsFit", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParamsFit", "[", 
   RowBox[{"params_", ",", "objf_", ",", "conf_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "cost", ",", " ", "iter", ",", "dcost", ",", "oldcost", ",", "oldparams",
       ",", "paramsinit", ",", 
      RowBox[{"initgradstep", "=", 
       RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}]}], ",", 
      RowBox[{"converge", "=", "0"}], ",", 
      RowBox[{"costlist", "=", 
       RowBox[{"{", "}"}]}], ",", "costinit", ",", 
      RowBox[{"fail", "=", "0"}], ",", 
      RowBox[{"maxfail", "=", "10"}], ",", 
      RowBox[{"msg", "=", "\"\<\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iter", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{"objf", "[", "params", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"costinit", "=", "cost"}], ";", 
     RowBox[{"paramsinit", "=", "params"}], ";", "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"costlist", ",", "cost"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{"True", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"oldcost", "=", "cost"}], ";", "\[IndentingNewLine]", 
           RowBox[{"oldparams", "=", "params"}], ";", "\[IndentingNewLine]", 
           RowBox[{"cost", "=", 
            RowBox[{"UpdateCost", "[", 
             RowBox[{"params", ",", "objf", ",", "conf"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"dcost", "=", 
            RowBox[{"cost", "-", "oldcost"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"dcost", ">=", "0"}], "&&", 
              RowBox[{"iter", ">", "1"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"revert", " ", "to", " ", "old", " ", "cond"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"cost", ",", "params"}], "}"}], "=", 
               RowBox[{"{", 
                RowBox[{"oldcost", ",", "oldparams"}], "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"fail", "++"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], "*=", "0.5"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"msg", "=", 
               RowBox[{"\"\<fail \>\"", "<>", 
                RowBox[{"ToString", "[", "fail", "]"}], "<>", 
                "\"\< times due to increasing cost. Set gradstep to \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                  RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], ",", 
                  "FortranForm"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"fail", ">=", "maxfail"}], ",", " ", 
                RowBox[{"(*", 
                 RowBox[{"consecutive", " ", "maxfails"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                 "Print", "[", 
                  "\"\<Reach consecutive maxfails. Optimisation fails\>\"", 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Break", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
               "]"}]}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"fail", "=", "0"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], "=", 
               "initgradstep"}], ";", "\[IndentingNewLine]", 
              RowBox[{"msg", "=", 
               RowBox[{
               "\"\<Recovered from fail. Set gradstep to \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                  RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], ",", 
                  "FortranForm"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"cost", "<=", 
              RowBox[{"conf", "[", "\"\<costfin\>\"", "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<seems converged to dcost=\>\"", ",", "dcost"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"++", "iter"}], ">", " ", 
                RowBox[{"conf", "[", "\"\<maxiter\>\"", "]"}]}], ")"}], "||", 
              
              RowBox[{"converge", ">=", 
               RowBox[{"conf", "[", "\"\<convergenum\>\"", "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<Reach maxiter or too flat: dcost=\>\"", ",", "dcost"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"costlist", ",", "cost"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"Column", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<cost=\>\"", "<>", 
           RowBox[{"ToString", "@", "cost"}]}], ",", 
          RowBox[{"\"\<iter=\>\"", "<>", 
           RowBox[{"ToString", "@", "iter"}]}], ",", "msg"}], "}"}]}]}], 
      "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"cost", ">=", "costinit"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Optimisation have failed, use the initial parameter guess\>\"", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"cost", ",", "params"}], "}"}], "=", 
         RowBox[{"{", 
          RowBox[{"costinit", ",", "paramsinit"}], "}"}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"costlist", ",", "cost"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"ListPlot", "[", "costlist", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"objf", "[", "params", "]"}], ",", "params"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0n00FXYYB3BdZFT35lZG8x4y2WWOmZOolNcubhImV+bl5ObOTbWcc+my
updcizQ2FFJRhCMjWXkX0WbmeNkuGpWXzOraWGfOzrXf9/fHcz7nef55zvc5
j1mUKDCWoaamFkEK1g1PBN0YXNy/sPDpZ7CjkhEJp46aRcHx29ua4b6IXKr/
30Ot0OKocw+szl3tg/mjngooFk9Ow2HdpVm4MX07o4zY3bpDHYZfiA6CNoob
IbAoQsWH7lfXxcHFO/EF0MO4qBBW7VGwbhLfOgv0IZPtZwRDDYKMYa9urz3s
4Vs5wdGgeC+oej/XG7bPHedCT/fAQGg9NBIM0zT6QmHkb6pwWNtYz4ch/gKN
SuKj7lTqaubgBpjflKUPY/ILzKCiOdkcKpsYH0Jv4b8cyDSXOsKMlEHqrkvf
7IZC/jFX2LB06QAcyfj5IHxRszL/gGiYWPQaBg/xluH5OncVPLn3jEYTMa9T
uh6eK1pnQftauTv07gjzhgO8FB/4vZUsAD6s0k6CbhmjYphWkPAVnFKzuwK7
OcXU0H88++Ew6+IzuJyUON9H3CxmL0CtcrZWP7FyPor64N1HBvBV23c76Dwu
1Q46KPUcoeKwwg3O64s84NgfX/vAiZZgHkyLLhVAfd9qqnJSNA3DZcFK2CSX
b3mGP7CY3QqrOC8/1v+F5DV3dICONuousDrb2APOGWRx4b6IH3nQTdshDLY5
86hCxZIAtssWhJBplC2BU7vWqMpVuQyyzVPTYWteVw7MZvkUQocv10rh8171
MvjeppQBqJd7h7p5awXTgBjsodoGJTU8Q/iqLYQaajucbEicLT+SCa29wkeN
iIqXZZNwu93dafifRLoALwdmnDIm7jz2Jgky00taYUJ9ThdkjBszTIjRdz+n
DmVyzeD9CudP4IGnFW7w4PgXe+FzFxeJKVGlI8qA8tZfC+HpgKvXoCTLpBtq
xst74ZvXdVcskOteO9V9TlkCJU5PaqHLkHM73OLV1QXDXuSMQT6viHpz1GCD
JXH32DK1PnyVBed1itnQlivmWBFvW0bbw5Mzp5yg4GHJHmh6etkfmpx9FwBt
fOtOwD8/iEmEnq5th3YSS3/w40LlObcpLu55oWsGmr4VJ/sR18tGZLBsjFUM
H3PElVB4JK8Gqmyt70Mbz4g2yJu83AnrROxDt4geM1mHYfOTb8/DCUEjNUHb
9SLUFfGlUMtKutxDHBAqVmBjxdk1GGQUr9dLbIiVWsIozUaqYJPR+FNiZ6Q1
NXCwYRFyRh5TmYZxI/YKsu9eJTWmRecvmHecRfVt6I+OJaatDJ6Apmd+ai//
fXH/rZZHHTBszeZ6BXGjumYp/B+fAzzy
  "],
 CellLabel->
  "In[5629]:=",ExpressionUUID->"ef82f5a6-d38a-4a59-bc34-a43b7cc6249d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fitting the Bell state ", "Section",
 CellChangeTimes->{{3.867524667987578*^9, 
  3.86752467595494*^9}},ExpressionUUID->"e1dce9e3-e9ed-4283-a8bf-\
cbaff7e3156e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "a", " ", "set", " ", "of", " ", "random", " ", "initial", " ", "states", 
    " ", "\[IndentingNewLine]", "It", " ", 
    RowBox[{"doesn", "'"}], "t", " ", "work", " ", "for", " ", "a", " ", 
    RowBox[{"set", ".", " ", "Cannot"}], " ", "handle", " ", "shot", " ", 
    RowBox[{"noise", "?"}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[Rho]mat", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"RandomMixState", "[", "7", "]"}], ",", 
      RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8677471854549513`*^9, 3.867747206113109*^9}, {
  3.867751111783306*^9, 3.867751113707391*^9}, {3.8678317311839943`*^9, 
  3.867831735192943*^9}, {3.867831772537204*^9, 3.8678317829259367`*^9}, {
  3.8678319243364553`*^9, 3.867831925098909*^9}, {3.867831979607675*^9, 
  3.8678320117316723`*^9}, {3.8678320686316853`*^9, 3.8678320691557093`*^9}, {
  3.867832352460476*^9, 3.867832381654084*^9}, {3.887530603349327*^9, 
  3.887530603594198*^9}},
 CellLabel->
  "In[5637]:=",ExpressionUUID->"667100a4-5af5-4c5b-a049-871185f7cf10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"bellcirc\[Rho]", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<01\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{
          RowBox[{"-", "\[Pi]"}], "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<12\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "2"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "1"], "[", 
         SubscriptBox["Z", "2"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "2"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<23\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "2"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "3"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "2"], "[", 
         SubscriptBox["Z", "3"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "3"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<34\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "3"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "4"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "3"], "[", 
         SubscriptBox["Z", "4"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "4"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<45\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "4"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "5"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "4"], "[", 
         SubscriptBox["Z", "5"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "5"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}]}], "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bellcirc\[Psi]", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<01\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["X", "0"], ",", 
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{
          RowBox[{"-", "\[Pi]"}], "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<12\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<23\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<34\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<45\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["X", "1"], ",", 
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}]}], "|>"}]}], 
  ";"}]}], "Input",
 CellLabel->
  "In[5638]:=",ExpressionUUID->"96708743-8d4c-4525-a3a0-0595b1ce61d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Rho]", "=", 
   RowBox[{"CreateDensityQureg", "[", "7", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]init", "=", 
   RowBox[{"CreateDensityQureg", "[", "7", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]2", "=", 
   RowBox[{"CreateDensityQureg", "[", "2", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]", "=", 
   RowBox[{"CreateQureg", "[", "7", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]2", "=", 
   RowBox[{"CreateQureg", "[", "2", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.868083642017118*^9, 3.868083649290572*^9}, {
  3.871347683026083*^9, 3.871347684682191*^9}, {3.887530610060205*^9, 
  3.887530612696014*^9}, {3.887530822583447*^9, 3.887530828673843*^9}},
 CellLabel->
  "In[5702]:=",ExpressionUUID->"194bd8c7-599e-4170-8584-307678b273b5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"concurence", "[", "\[Rho]_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "eigv", ",", "\[Rho]m", ",", "\[Rho]ms", ",", "\[Rho]t", ",", "nq", ",",
        "pauliy"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Rho]m", "=", 
       RowBox[{"GetQuregMatrix", "@", "\[Rho]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nq", "=", 
       RowBox[{"IntegerPart", "@", 
        RowBox[{"Log2", "@", 
         RowBox[{"Length", "@", "\[Rho]m"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]ms", "=", 
       RowBox[{"MatrixPower", "[", 
        RowBox[{"\[Rho]m", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pauliy", "=", 
       RowBox[{"CalcCircuitMatrix", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["Y", "#"], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{"nq", "-", "1"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Rho]t", "=", 
       RowBox[{"pauliy", ".", 
        RowBox[{"Conjugate", "[", "\[Rho]m", "]"}], ".", "pauliy"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"eigv", "=", 
       RowBox[{"Reverse", "@", 
        RowBox[{"Sort", "[", 
         RowBox[{"Chop", "@", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"MatrixPower", "[", 
            RowBox[{
             RowBox[{"\[Rho]ms", ".", "\[Rho]t", ".", "\[Rho]ms"}], ",", 
             RowBox[{"1", "/", "2"}]}], "]"}], "]"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Max", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"eigv", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "-", 
         RowBox[{"Total", "@", 
          RowBox[{"eigv", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bellcost", "[", "params_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "qubits", ",", "plot", ",", "codes", ",", "fidtarget", ",", "conctarget",
       ",", "opt", ",", "noisycirc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"codes", "=", 
      RowBox[{"ReplaceList", "[", 
       RowBox[{
        RowBox[{"Sort", "@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "5"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p___", ",", "a_", ",", "b_", ",", "q___"}], "}"}], ":>", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}], ",", "\"\<\>\""}], "]"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fidtarget", "=", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<01\>\"", "->", "89.2"}], ",", 
        RowBox[{"\"\<12\>\"", "->", "90.1"}], ",", 
        RowBox[{"\"\<23\>\"", "->", "88.3"}], ",", 
        RowBox[{"\"\<34\>\"", "->", "95.6"}], ",", 
        RowBox[{"\"\<45\>\"", "->", "94.1"}]}], "|>"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"conctarget", "=", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<01\>\"", "->", "86.7"}], ",", 
        RowBox[{"\"\<12\>\"", "->", "83.9"}], ",", 
        RowBox[{"\"\<23\>\"", "->", "87.9"}], ",", 
        RowBox[{"\"\<34\>\"", "->", "94.9"}], ",", 
        RowBox[{"\"\<45\>\"", "->", "90.6"}]}], "|>"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"opt", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"FidCZ", "\[Rule]", 
         RowBox[{"\[LeftAssociation]", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            SubscriptBox["\[Theta]", "0"]}], ",", 
           RowBox[{"1", "\[Rule]", 
            SubscriptBox["\[Theta]", "1"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            SubscriptBox["\[Theta]", "2"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            SubscriptBox["\[Theta]", "3"]}], ",", 
           RowBox[{"4", "\[Rule]", 
            SubscriptBox["\[Theta]", "4"]}]}], "\[RightAssociation]"}]}], 
        "}"}], "/.", "params"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Mean", "@", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"qubits", "=", 
          RowBox[{"ToExpression", "@", 
           RowBox[{"StringSplit", "[", 
            RowBox[{"code", ",", "\"\<\>\""}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CloneQureg", "[", 
          RowBox[{"\[Rho]", ",", "\[Rho]init"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"noisycirc", "=", 
          RowBox[{"ExtractCircuit", "@", 
           RowBox[{"InsertCircuitNoise", "[", 
            RowBox[{
             RowBox[{"Serialize", "@", 
              RowBox[{"{", 
               RowBox[{"bellcirc\[Rho]", "[", "code", "]"}], "}"}]}], ",", 
             RowBox[{"SiliconDelft", "[", 
              RowBox[{"Sequence", "@@", "opt"}], "]"}], ",", " ", 
             RowBox[{"ReplaceAliases", "->", "True"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"noisycirc", "=", 
          RowBox[{"SimplifyCircuit", "[", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{"noisycirc", ",", 
               RowBox[{
                SubscriptBox["Depol", "__"], "[", "0.", "]"}]}], "]"}], ",", 
             RowBox[{
              SubscriptBox["Deph", "__"], "[", "0.", "]"}]}], "]"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"ApplyCircuit", "[", 
          RowBox[{"\[Rho]", ",", "noisycirc"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"SetQuregMatrix", "[", 
          RowBox[{"\[Rho]2", ",", 
           RowBox[{"PartialTrace", "[", 
            RowBox[{"\[Rho]", ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"Complement", "[", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", "5"}], "]"}], ",", "qubits"}], "]"}]}], 
             ",", "6"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ApplyCircuit", "[", 
          RowBox[{
           RowBox[{"InitZeroState", "@", "\[Psi]2"}], ",", 
           RowBox[{"bellcirc\[Psi]", "[", "code", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"CalcFidelity", "[", 
              RowBox[{"\[Rho]2", ",", "\[Psi]2"}], "]"}], "*", "100"}], "-", 
            RowBox[{"fidtarget", "[", "code", "]"}]}], "]"}], "+", 
          RowBox[{"0.8", "*", 
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"concurence", "[", "\[Rho]2", "]"}], "*", "100"}], "-", 
             
             RowBox[{"conctarget", "[", "code", "]"}]}], "]"}]}]}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"code", ",", "codes"}], "}"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.825267110790401*^9, 3.825267143982016*^9}, {
   3.82526720407201*^9, 3.825267467400854*^9}, {3.825267501702174*^9, 
   3.82526756076999*^9}, {3.825496944903048*^9, 3.825497017484922*^9}, {
   3.825497146161373*^9, 3.825497348871545*^9}, {3.8254973796165*^9, 
   3.825497399324679*^9}, {3.8254974806505136`*^9, 3.825497490600483*^9}, {
   3.8254979908864927`*^9, 3.825498082450001*^9}, 3.825499029490715*^9, {
   3.825545452994638*^9, 3.825545456200333*^9}, {3.825660460013022*^9, 
   3.825660460789646*^9}, {3.825665157718223*^9, 3.825665158522024*^9}, {
   3.825665304807225*^9, 3.825665310440206*^9}, 3.825668265294799*^9, {
   3.825668337811079*^9, 3.825668352678597*^9}, {3.825670066163863*^9, 
   3.825670084399976*^9}, {3.8256702560838423`*^9, 3.825670265614257*^9}, {
   3.825673300556446*^9, 3.825673307860298*^9}, {3.8257722934121513`*^9, 
   3.825772295131913*^9}, {3.826094093102723*^9, 3.826094093366527*^9}, {
   3.826119278388644*^9, 3.8261192959062643`*^9}, {3.826119356729138*^9, 
   3.826119364011222*^9}, {3.826128514454879*^9, 3.82612851491475*^9}, {
   3.8261307804965687`*^9, 3.8261308202093163`*^9}, {3.82613092003253*^9, 
   3.826130922614195*^9}, {3.8297372286987267`*^9, 3.8297372585806503`*^9}, {
   3.829737311870933*^9, 3.829737340579496*^9}, {3.829739266861483*^9, 
   3.8297392939617043`*^9}, {3.851147187480413*^9, 3.851147280471786*^9}, {
   3.851160511438092*^9, 3.851160515543365*^9}, {3.852264620098432*^9, 
   3.852264626164201*^9}, {3.866027567230999*^9, 3.8660276326302223`*^9}, {
   3.8660276657256413`*^9, 3.86602775709483*^9}, {3.866028031786592*^9, 
   3.8660280330596027`*^9}, {3.866028238687357*^9, 3.866028464791641*^9}, {
   3.866028516480823*^9, 3.8660286009604683`*^9}, {3.8660288006943827`*^9, 
   3.866028808934939*^9}, {3.866036777931102*^9, 3.866036786401905*^9}, {
   3.8660644674189587`*^9, 3.866064467916654*^9}, {3.8683475527831*^9, 
   3.868347575591151*^9}, {3.868445819596507*^9, 3.868445821785376*^9}, {
   3.868522226412394*^9, 3.868522247318428*^9}, {3.8685250749534883`*^9, 
   3.8685251299914007`*^9}, {3.868525256512422*^9, 3.868525338944009*^9}, {
   3.868525382137167*^9, 3.8685254634460373`*^9}, {3.8685255016061*^9, 
   3.8685255719818287`*^9}, {3.868527069893175*^9, 3.8685271095538073`*^9}, 
   3.868529489931985*^9, {3.8685299429584837`*^9, 3.868529961753438*^9}, {
   3.8685305180249453`*^9, 3.868530524404146*^9}, {3.868530590687324*^9, 
   3.8685306963552732`*^9}, {3.868602306108157*^9, 3.8686024518756437`*^9}, {
   3.868603125939369*^9, 3.868603216906681*^9}, {3.869051877727064*^9, 
   3.8690519082164307`*^9}, {3.869052696405917*^9, 3.869052762053029*^9}, {
   3.869052818645396*^9, 3.869052924521402*^9}, {3.8690530038393583`*^9, 
   3.8690530579575577`*^9}, {3.871029686169116*^9, 3.871029692450163*^9}, {
   3.871030359307041*^9, 3.871030380140921*^9}, {3.871030428094634*^9, 
   3.8710304318180923`*^9}, {3.871030517201104*^9, 3.871030578208631*^9}, {
   3.87132820279539*^9, 3.871328207636612*^9}, {3.871347694407195*^9, 
   3.871347696567253*^9}, {3.871347772598177*^9, 3.8713477758696213`*^9}, {
   3.871347991851853*^9, 3.871347996042152*^9}, {3.8713480363381653`*^9, 
   3.871348051364788*^9}, {3.87134809227966*^9, 3.871348092444755*^9}, 
   3.8713481599604177`*^9, {3.871348388818915*^9, 3.8713484080671167`*^9}, {
   3.871348505076089*^9, 3.8713485052751303`*^9}, {3.871442206893854*^9, 
   3.871442216263324*^9}, {3.8725984235292253`*^9, 3.872598435385549*^9}, {
   3.8725985200630693`*^9, 3.872598520443049*^9}, {3.872598854713922*^9, 
   3.8725988596128283`*^9}, {3.87535025689466*^9, 3.875350316441461*^9}, {
   3.875350378648464*^9, 3.8753504077027473`*^9}, {3.875353870812183*^9, 
   3.8753538719812403`*^9}, {3.887530619978059*^9, 3.8875306813177433`*^9}, {
   3.887530771254355*^9, 3.887530772976584*^9}, {3.887530831716411*^9, 
   3.887530865007777*^9}, {3.887530932790127*^9, 3.887530938765915*^9}},
 CellLabel->
  "In[5711]:=",ExpressionUUID->"97c263b8-b0a9-47ff-9911-a89e83bfdb24"],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"shock", ",", "HoldFirst"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shock", "[", 
   RowBox[{"params_", ",", "d\[Theta]_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "rands", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"rands", "=", 
        RowBox[{
         RowBox[{"RandomChoice", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "*", 
         "d\[Theta]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"params", "[", "k", "]"}], "+", "rands"}], ")"}], ">=", 
          "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"params", "[", "k", "]"}], "+=", "rands"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"params", "[", "k", "]"}], "-=", "rands"}]}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", 
        RowBox[{"Keys", "@", "params"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.868197059546958*^9, 3.868197130512484*^9}, {
  3.8713485955075607`*^9, 3.871348745579968*^9}},
 CellLabel->
  "In[5697]:=",ExpressionUUID->"05e29458-cdfa-40ad-afbf-a9583e507ded"],

Cell[BoxData[
 RowBox[{
  RowBox[{"params", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Theta]", "0"], "\[Rule]", "0.95"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "1"], "\[Rule]", "0.94"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "2"], "\[Rule]", "0.935"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "3"], "\[Rule]", "0.96"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "4"], "\[Rule]", "0.97"}]}], "|>"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.871347709399486*^9, 3.8713477372813387`*^9}, {
  3.871347853778796*^9, 3.871347856384119*^9}, {3.871347942769764*^9, 
  3.8713479439036007`*^9}, {3.871349693730463*^9, 3.871349705727961*^9}, {
  3.8714422288388147`*^9, 3.871442243475116*^9}, {3.872598467911631*^9, 
  3.872598479665348*^9}},
 CellLabel->
  "In[5684]:=",ExpressionUUID->"6a509c95-ab7a-48ef-8e0c-d7206d661fb7"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"rfid", "=", 
  RowBox[{"RandomVariate", "[", 
   RowBox[{
    RowBox[{"NormalDistribution", "[", 
     RowBox[{"0.91", ",", "0.01"}], "]"}], ",", "5"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"idx", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"params", "=", 
  RowBox[{"Association", "[", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["\[Theta]", 
        RowBox[{"idx", "++"}]], "->", "#"}], "&"}], "/@", "rfid"}], ")"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.875350573007491*^9, 3.875350634552552*^9}, {
  3.8753506650935593`*^9, 3.87535066564039*^9}, {3.875350708736341*^9, 
  3.875350842335101*^9}},
 CellLabel->
  "In[5685]:=",ExpressionUUID->"b1408095-5286-4b7f-af6b-f0191f35a3bd"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.9174431368919629`", ",", "0.9257569398578163`", ",", 
   "0.9229892954108119`", ",", "0.9101812877508374`", ",", 
   "0.9079262205036925`"}], "}"}]], "Output",
 CellChangeTimes->{{3.875350610727167*^9, 3.875350634912307*^9}, 
   3.875350666400722*^9, {3.87535070991716*^9, 3.875350721456609*^9}, {
   3.875350782545744*^9, 3.875350842723699*^9}, 3.87535387889102*^9, {
   3.8875306879932404`*^9, 3.887530721813217*^9}},
 CellLabel->
  "Out[5685]=",ExpressionUUID->"1d7a94f0-05e0-4d70-8204-3d76fbf95216"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{
    SubscriptBox["\[Theta]", "0"], "\[Rule]", "0.9174431368919629`"}], ",", 
   RowBox[{
    SubscriptBox["\[Theta]", "1"], "\[Rule]", "0.9257569398578163`"}], ",", 
   RowBox[{
    SubscriptBox["\[Theta]", "2"], "\[Rule]", "0.9229892954108119`"}], ",", 
   RowBox[{
    SubscriptBox["\[Theta]", "3"], "\[Rule]", "0.9101812877508374`"}], ",", 
   RowBox[{
    SubscriptBox["\[Theta]", "4"], "\[Rule]", "0.9079262205036925`"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{{3.875350610727167*^9, 3.875350634912307*^9}, 
   3.875350666400722*^9, {3.87535070991716*^9, 3.875350721456609*^9}, {
   3.875350782545744*^9, 3.875350842723699*^9}, 3.87535387889102*^9, {
   3.8875306879932404`*^9, 3.887530721816311*^9}},
 CellLabel->
  "Out[5687]=",ExpressionUUID->"d3d037f6-7eb1-4b18-ad5f-216c9eda91ae"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetQuregMatrix", "[", 
   RowBox[{"\[Rho]init", ",", 
    RowBox[{"RandomChoice", "[", "\[Rho]mat", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initrep", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"readInit3", "[", 
    RowBox[{"\[Rho]init", ",", "5", ",", "4", ",", "3", ",", "opt"}], "]"}], 
   ",", 
   RowBox[{"{", "initrep", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"readInit3", "[", 
     RowBox[{"\[Rho]init", ",", "0", ",", "1", ",", "2", ",", "opt"}], "]"}], 
    ",", 
    RowBox[{"{", "initrep", "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"confinit", "=", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<nqubits\>\"", "->", "6"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<maxiter\>\"", "->", "1000"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<gradstep\>\"", "->", 
      SuperscriptBox["10", 
       RowBox[{"-", "4"}]]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<gradstepmultiply\>\"", "->", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"delta", " ", "params"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\"\<d\[Theta]\>\"", "->", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<convergenum\>\"", "->", "10"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{"\"\<costfin\>\"", "->", 
      SuperscriptBox["10", 
       RowBox[{"-", "8"}]]}]}], "\[IndentingNewLine]", "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"conf", "=", "confinit"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"cost", ",", "params"}], "}"}], "=", 
   RowBox[{"ParamsFit", "[", 
    RowBox[{"params", ",", "bellcost", ",", "conf"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.867478584210462*^9, 3.867478614436969*^9}, 
   3.867563769372993*^9, {3.8677217008942633`*^9, 3.867721701190997*^9}, 
   3.8677221085928917`*^9, {3.867722184761245*^9, 3.867722192358831*^9}, {
   3.867722406702756*^9, 3.867722411107815*^9}, {3.867722469619976*^9, 
   3.86772246976268*^9}, {3.867722610411024*^9, 3.867722611760829*^9}, {
   3.867722856605383*^9, 3.867722872136366*^9}, 3.8677229999323473`*^9, {
   3.8677234115927134`*^9, 3.8677234172291393`*^9}, {3.867723749607395*^9, 
   3.867723763081842*^9}, {3.867723865840068*^9, 3.8677238662760677`*^9}, 
   3.867724006895512*^9, 3.867724089636261*^9, {3.867735488745541*^9, 
   3.867735513009944*^9}, {3.867736499178773*^9, 3.867736509969434*^9}, {
   3.867739505777604*^9, 3.867739521001072*^9}, {3.867739567362053*^9, 
   3.867739590124502*^9}, {3.8677396446240253`*^9, 3.867739666712409*^9}, {
   3.867739716022945*^9, 3.86773971788547*^9}, {3.8677401297487183`*^9, 
   3.86774013018883*^9}, {3.867740332134946*^9, 3.867740348591604*^9}, {
   3.867747274990309*^9, 3.867747275355605*^9}, {3.867747386981043*^9, 
   3.8677474223156643`*^9}, {3.86774747203686*^9, 3.86774747716665*^9}, {
   3.867747532092052*^9, 3.867747533236147*^9}, {3.867747716475049*^9, 
   3.8677478236621103`*^9}, {3.867748080215173*^9, 3.867748090647698*^9}, {
   3.8677481423230047`*^9, 3.867748142550969*^9}, 3.867748212409244*^9, {
   3.867748299103956*^9, 3.867748311840644*^9}, {3.867748355105878*^9, 
   3.867748407870962*^9}, {3.86774851110168*^9, 3.867748592659658*^9}, 
   3.8677486294081173`*^9, {3.867748723540269*^9, 3.867748750995431*^9}, {
   3.867750721431233*^9, 3.8677507345673113`*^9}, {3.867750797191193*^9, 
   3.867750816133525*^9}, {3.867750890955744*^9, 3.86775090455231*^9}, {
   3.867751099067903*^9, 3.867751107461033*^9}, 3.867751199638785*^9, {
   3.867751554105598*^9, 3.867751568457637*^9}, {3.8677517126154346`*^9, 
   3.867751739619873*^9}, {3.867752866062779*^9, 3.8677528671215754`*^9}, {
   3.8677533380256357`*^9, 3.867753340724971*^9}, {3.867754369231785*^9, 
   3.867754389743754*^9}, 3.867754651480399*^9, {3.86776588088827*^9, 
   3.867765882699514*^9}, {3.867828236208877*^9, 3.867828236631351*^9}, 
   3.8678294620042753`*^9, {3.867829523474901*^9, 3.867829527621636*^9}, {
   3.8678297896958227`*^9, 3.867829789886693*^9}, 3.8678298466216927`*^9, {
   3.867829908950405*^9, 3.867829909117131*^9}, {3.867830078532432*^9, 
   3.867830083057901*^9}, {3.8678303863981037`*^9, 3.86783038875496*^9}, {
   3.8678307598769627`*^9, 3.867830766207695*^9}, 3.8678312167034597`*^9, {
   3.8678318709610147`*^9, 3.867831906593748*^9}, {3.867831975434885*^9, 
   3.8678319756133137`*^9}, {3.867832019595372*^9, 3.867832039816478*^9}, {
   3.8680061607920723`*^9, 3.86800617172171*^9}, {3.8680068684215727`*^9, 
   3.868006869365733*^9}, {3.868008337279924*^9, 3.868008345251088*^9}, {
   3.86800841749784*^9, 3.8680084184179277`*^9}, {3.8680086535410423`*^9, 
   3.868008691129301*^9}, {3.8680095270254297`*^9, 3.868009527205689*^9}, {
   3.868077159831731*^9, 3.868077172041079*^9}, {3.868077254909052*^9, 
   3.868077320317895*^9}, {3.868077392287406*^9, 3.868077397613968*^9}, {
   3.868079825265657*^9, 3.86807982544315*^9}, {3.8680803418163757`*^9, 
   3.868080354269348*^9}, {3.868080615425458*^9, 3.8680806230031023`*^9}, {
   3.86808066288321*^9, 3.868080668553878*^9}, {3.8680838749111767`*^9, 
   3.868083902459324*^9}, {3.8680840052154284`*^9, 3.86808400600381*^9}, {
   3.868086703955998*^9, 3.868086705489009*^9}, {3.868086870048427*^9, 
   3.868086949275113*^9}, {3.868087280594368*^9, 3.8680872936134033`*^9}, {
   3.868196962870204*^9, 3.868196979660488*^9}, {3.868197160238612*^9, 
   3.868197160883505*^9}, {3.868197256510895*^9, 3.868197285078189*^9}, {
   3.868197396081946*^9, 3.8681974190358887`*^9}, {3.868197522369574*^9, 
   3.868197530209793*^9}, {3.871348474541276*^9, 3.871348475228479*^9}, {
   3.87134875059665*^9, 3.871348757100319*^9}, {3.871353783929513*^9, 
   3.871353797734386*^9}, {3.871355551259571*^9, 3.871355573535534*^9}, {
   3.8875308452573853`*^9, 3.887530916150737*^9}},
 CellLabel->
  "In[5713]:=",ExpressionUUID->"d97f39dd-75da-4c67-92ba-152bd68f8908"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.887530727113121*^9, 3.8875307567764482`*^9}, 
   3.887530798228099*^9, 3.887530946738521*^9},
 CellLabel->
  "Out[5715]=",ExpressionUUID->"621f3478-edc2-42e6-a70e-1218a5b749e9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.887530727113121*^9, 3.8875307567764482`*^9}, 
   3.887530798228099*^9, 3.887530946791953*^9},
 CellLabel->
  "Out[5716]=",ExpressionUUID->"206b0352-781e-4c1f-b8ac-b7f642d9eeed"],

Cell[BoxData[
 TemplateBox[{
  "FidCZ", "error", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"not a fidelity number or association of \
fidelities with length 5\\\\\\\"\\\"}]\\)\"", 2, 5719, 95, 
   26770999880986910140, "Local", "VQD`ParameterDevices`FidCZ"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.887530946795393*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"4af1a82b-6929-401f-b1a9-e9d60a692f3f"],

Cell[BoxData[
 TemplateBox[{
  "FidCZ", "warning", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"(warning) Fidelity might be too low; \
2-qubit dephasing parameter is \
\\\\\\\\!\\\\\\\\(\\\\\\\\*RowBox[{\\\\\\\\\\\\\\\"3.528598905640444`\\\\\\\\\
\\\\\\\"}]\\\\\\\\). Set it to 3/4.\\\\\\\"\\\"}]\\)\"", 2, 5719, 96, 
   26770999880986910140, "Local", "VQD`ParameterDevices`FidCZ"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.887530946802814*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"d5eb1c3f-ad4f-4cce-a6b6-fa069aa21782"],

Cell[BoxData[
 TemplateBox[{
  "FidCZ", "warning", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"(warning) Fidelity might be too low; \
2-qubit dephasing parameter is \
\\\\\\\\!\\\\\\\\(\\\\\\\\*RowBox[{\\\\\\\\\\\\\\\"2.0086767339888087`\\\\\\\\\
\\\\\\\"}]\\\\\\\\). Set it to 3/4.\\\\\\\"\\\"}]\\)\"", 2, 5719, 97, 
   26770999880986910140, "Local", "VQD`ParameterDevices`FidCZ"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.887530946808391*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"b8b53e20-a103-4172-befb-671772f8fe7c"],

Cell[BoxData[
 TemplateBox[{
  "FidCZ", "error", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"not a fidelity number or association of \
fidelities with length 5\\\\\\\"\\\"}]\\)\"", 2, 5719, 98, 
   26770999880986910140, "Local", "VQD`ParameterDevices`FidCZ"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.8875309468929663`*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"37cc10ca-982a-4649-a9be-25a0ff7d16e0"],

Cell[BoxData[
 TemplateBox[{
  "FidCZ", "warning", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"(warning) Fidelity might be too low; \
2-qubit dephasing parameter is \
\\\\\\\\!\\\\\\\\(\\\\\\\\*RowBox[{\\\\\\\\\\\\\\\"3.528598905640444`\\\\\\\\\
\\\\\\\"}]\\\\\\\\). Set it to 3/4.\\\\\\\"\\\"}]\\)\"", 2, 5719, 99, 
   26770999880986910140, "Local", "VQD`ParameterDevices`FidCZ"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.88753094689883*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"e855cc56-edbc-437e-b797-6e9595b5e377"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"FidCZ\\\", \\\"::\\\", \
\\\"warning\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"", 2, 5719, 100, 26770999880986910140, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.887530946904132*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"06986157-a6be-4961-bc28-1a99bb83990f"],

Cell[BoxData[
 TemplateBox[{
  "FidCZ", "error", 
   "\"\\!\\(\\*RowBox[{\\\"\\\\\\\"not a fidelity number or association of \
fidelities with length 5\\\\\\\"\\\"}]\\)\"", 2, 5719, 101, 
   26770999880986910140, "Local", "VQD`ParameterDevices`FidCZ"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.887530946962545*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"b26e9102-a8f8-4684-b0a9-72171e310511"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"FidCZ\\\", \\\"::\\\", \
\\\"error\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"", 2, 5719, 102, 26770999880986910140, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{{3.887530723239304*^9, 3.887530752987339*^9}, 
   3.887530791332232*^9, 3.887530946968486*^9},
 CellLabel->
  "During evaluation of \
In[5713]:=",ExpressionUUID->"9ec1c1e3-239e-46c6-a5bd-fdb856b5b27d"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{{3.887530727113121*^9, 3.8875307567764482`*^9}, 
   3.887530798228099*^9, 3.887530954945376*^9},
 CellLabel->
  "Out[5719]=",ExpressionUUID->"7731917e-05c2-424c-adff-6a70ad3bb901"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["cost"], "Input",
 CellChangeTimes->{{3.8682011207542763`*^9, 3.868201121238194*^9}},
 CellLabel->
  "In[254]:=",ExpressionUUID->"810fdf0c-87d0-4a97-a1ef-37c4d61ce172"],

Cell[BoxData["2.164975043903283`"], "Output",
 CellChangeTimes->{3.871443986991776*^9, 3.8726023277279797`*^9, 
  3.875350278658381*^9, 3.8753537795988483`*^9, 3.8753545821949177`*^9, 
  3.875354647988958*^9},
 CellLabel->
  "Out[254]=",ExpressionUUID->"b110fca4-8dbf-430d-937a-7a97a80ebd3f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"i", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Association", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"i", "++"}], "->", "#"}], "&"}], "/@", 
   RowBox[{"Values", "@", "params"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.867831000090022*^9, 3.867831047698482*^9}, {
  3.8714440571204643`*^9, 3.8714440596457863`*^9}},
 CellLabel->
  "In[249]:=",ExpressionUUID->"e4c8f46b-3c45-44a9-9c96-c1f340f7efed"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"0", "\[Rule]", "0.923183863809979`"}], ",", 
   RowBox[{"1", "\[Rule]", "0.9251802905460701`"}], ",", 
   RowBox[{"2", "\[Rule]", "0.9165542930600132`"}], ",", 
   RowBox[{"3", "\[Rule]", "0.9798864454494498`"}], ",", 
   RowBox[{"4", "\[Rule]", "0.9650765790506154`"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{
  3.867831011428205*^9, 3.867831048350876*^9, {3.867831384528637*^9, 
   3.867831388294718*^9}, 3.867831848309023*^9, 3.867832287290062*^9, 
   3.868007059200584*^9, {3.86800773917802*^9, 3.868007749554113*^9}, 
   3.868007892305319*^9, 3.868008451998466*^9, 3.868009022638466*^9, {
   3.868010097868264*^9, 3.8680101129489307`*^9}, 3.868079847373555*^9, 
   3.868083680864011*^9, 3.868085344751231*^9, 3.8680868473448687`*^9, 
   3.868087161111635*^9, 3.8713564604224777`*^9, 3.871442009676528*^9, 
   3.8714421425887947`*^9, 3.871443992016675*^9, 3.871444059991618*^9, 
   3.872602327748749*^9, 3.875350278679123*^9, 3.875353781494804*^9, 
   3.8753545822148657`*^9},
 CellLabel->
  "Out[250]=",ExpressionUUID->"1e706bda-7cb3-4919-a2cd-52c349781147"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"bellcost", "[", "params", "]"}]], "Input",
 CellChangeTimes->{{3.86807975157582*^9, 3.868079753069673*^9}, {
  3.868086624139592*^9, 3.868086625708959*^9}},
 CellLabel->
  "In[251]:=",ExpressionUUID->"0cab19b4-cd6f-4a36-a845-d3eaa8492b83"],

Cell[BoxData["2.164975043903283`"], "Output",
 CellChangeTimes->{
  3.867829821204117*^9, 3.86782988547309*^9, 3.867829984025478*^9, 
   3.867830150847775*^9, 3.8678303137825327`*^9, {3.867830345808468*^9, 
   3.8678303484788933`*^9}, {3.867830971233819*^9, 3.867830988252862*^9}, {
   3.8678313846320047`*^9, 3.8678313892694902`*^9}, {3.867831848438449*^9, 
   3.86783186322208*^9}, 3.867831968379147*^9, 3.867832288355042*^9, 
   3.868007062411025*^9, {3.868007739289916*^9, 3.868007753139139*^9}, 
   3.868008452058819*^9, 3.868009022652688*^9, 3.868009073386723*^9, {
   3.868010099808971*^9, 3.868010115005505*^9}, {3.868010181343219*^9, 
   3.868010188541646*^9}, 3.8680797537125273`*^9, 3.86807984750747*^9, 
   3.868083681014669*^9, 3.868083839353265*^9, 3.868083919433448*^9, 
   3.868085344882468*^9, 3.868087161275325*^9, {3.871347562494996*^9, 
   3.871347566213564*^9}, 3.871356461188591*^9, 3.8714420104262047`*^9, 
   3.8714421450949306`*^9, 3.871443995853647*^9, 3.8726023284541683`*^9, 
   3.8753502787263737`*^9, 3.875353788356392*^9, 3.8753545832252007`*^9},
 CellLabel->
  "Out[251]=",ExpressionUUID->"af67a0f9-592c-4996-98f2-5987e0ef5a36"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"fids", "[", "params_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "init", ",", "qubits", ",", "plot", ",", "codes", ",", "fidtarget", ",", 
      "opt", ",", "dev", ",", "noisycirc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"codes", "=", 
      RowBox[{"ReplaceList", "[", 
       RowBox[{
        RowBox[{"Sort", "@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "5"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p___", ",", "a_", ",", "b_", ",", "q___"}], "}"}], ":>", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}], ",", "\"\<\>\""}], "]"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"opt", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"FidCZ", "\[Rule]", 
         RowBox[{"\[LeftAssociation]", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            SubscriptBox["\[Theta]", "0"]}], ",", 
           RowBox[{"1", "\[Rule]", 
            SubscriptBox["\[Theta]", "1"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            SubscriptBox["\[Theta]", "2"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            SubscriptBox["\[Theta]", "3"]}], ",", 
           RowBox[{"4", "\[Rule]", 
            SubscriptBox["\[Theta]", "4"]}]}], "\[RightAssociation]"}]}], 
        "}"}], "/.", "params"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dev", "=", 
      RowBox[{"SiliconDelft", "[", 
       RowBox[{"Sequence", "@@", "opt"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"init", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"qubits", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"StringSplit", "[", 
           RowBox[{"code", ",", "\"\<\>\""}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"Intersection", "[", 
             RowBox[{"qubits", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ">", 
           "0"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"init", ",", 
            SubscriptBox["Init", 
             RowBox[{"0", ",", "1", ",", "2"}]]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"Intersection", "[", 
             RowBox[{"qubits", ",", 
              RowBox[{"{", 
               RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "]"}]}], ">", 
           "0"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"init", ",", 
            SubscriptBox["Init", 
             RowBox[{"3", ",", "4", ",", "5"}]]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetQuregMatrix", "[", 
         RowBox[{"\[Rho]", ",", 
          RowBox[{"RandomChoice", "@", "\[Rho]mat"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"noisycirc", "=", 
         RowBox[{"ExtractCircuit", "@", 
          RowBox[{"InsertCircuitNoise", "[", 
           RowBox[{
            RowBox[{"Serialize", "@", 
             RowBox[{"{", 
              RowBox[{"init", ",", 
               RowBox[{"bellcirc\[Rho]", "[", "code", "]"}]}], "}"}]}], ",", 
            RowBox[{"SiliconDelft", "[", 
             RowBox[{"Sequence", "@@", "opt"}], "]"}], ",", " ", 
            RowBox[{"ReplaceAliases", "->", "True"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"noisycirc", "=", 
         RowBox[{"SimplifyCircuit", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"noisycirc", ",", 
              RowBox[{
               SubscriptBox["Depol", "__"], "[", "0.", "]"}]}], "]"}], ",", 
            RowBox[{
             SubscriptBox["Deph", "__"], "[", "0.", "]"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"ApplyCircuit", "[", 
         RowBox[{"\[Rho]", ",", "noisycirc"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetQuregMatrix", "[", 
         RowBox[{"\[Rho]2", ",", 
          RowBox[{"PartialTrace", "[", 
           RowBox[{"\[Rho]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"Complement", "[", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"0", ",", "5"}], "]"}], ",", "qubits"}], "]"}]}]}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ApplyCircuit", "[", 
         RowBox[{
          RowBox[{"InitZeroState", "@", "\[Psi]2"}], ",", 
          RowBox[{"bellcirc\[Psi]", "[", "code", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"CalcFidelity", "[", 
            RowBox[{"\[Rho]2", ",", "\[Psi]2"}], "]"}], "*", "100"}], ",", 
          RowBox[{
           RowBox[{"concurence", "[", "\[Rho]2", "]"}], "*", "100"}]}], 
         "}"}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"code", ",", "codes"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.867740950405389*^9, 3.867740964340288*^9}, {
   3.86774868361053*^9, 3.8677487053141003`*^9}, {3.86775451511749*^9, 
   3.86775451925145*^9}, {3.8678284294771*^9, 3.8678284427981167`*^9}, {
   3.867828492470105*^9, 3.867828519124596*^9}, {3.8678287488241463`*^9, 
   3.8678287664650784`*^9}, {3.867829074144292*^9, 3.867829099034978*^9}, {
   3.867829134889765*^9, 3.867829210210071*^9}, {3.8678293439555473`*^9, 
   3.867829347357991*^9}, {3.867829402223761*^9, 3.8678294443859043`*^9}, {
   3.867829487854457*^9, 3.867829488073903*^9}, 3.867830791481938*^9, {
   3.867831858320448*^9, 3.8678318607548847`*^9}, {3.868006189003784*^9, 
   3.8680062061138773`*^9}, {3.868008391912711*^9, 3.868008393128044*^9}, {
   3.868009042835994*^9, 3.868009070991314*^9}, 3.8680095351469307`*^9, 
   3.868010185655253*^9, 3.8680797316193867`*^9, {3.871347584444983*^9, 
   3.871347596255004*^9}, 3.8714421613208647`*^9, {3.875350539238673*^9, 
   3.875350546434772*^9}},
 CellLabel->
  "In[252]:=",ExpressionUUID->"51f33504-12f1-421a-afbe-b5e4fb54c3c1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"fids", "[", "params", "]"}]], "Input",
 CellChangeTimes->{{3.8680797347651863`*^9, 3.86807973638686*^9}},
 CellLabel->
  "In[253]:=",ExpressionUUID->"73d3a447-74ac-419d-b8de-055eb9df9414"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"88.8553223748359`", ",", "78.69323176797597`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"89.83953806001604`", ",", "79.74778261163354`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"88.39386820052837`", ",", "78.50003631700659`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"95.20816900231677`", ",", "93.27327945324254`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"93.83773729036817`", ",", "89.6588752084778`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.868079737008864*^9, 3.868079745037704*^9}, 
   3.8680798476319027`*^9, 3.868083681151545*^9, 3.868085345150474*^9, 
   3.868087161514423*^9, 3.8713475687956543`*^9, 3.871356487926304*^9, 
   3.871442035966674*^9, 3.871442164606838*^9, 3.8714440005827923`*^9, 
   3.87260232923098*^9, 3.875350278880521*^9, 3.875353793979248*^9, 
   3.875354584287822*^9},
 CellLabel->
  "Out[253]=",ExpressionUUID->"45462f19-5b49-4a28-84cf-67374a06ecc7"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1296., 801.5},
WindowMargins->{{0, Automatic}, {0, Automatic}},
Magnification:>0.6 Inherited,
FrontEndVersion->"13.1 for Linux x86 (64-bit) (June 16, 2022)",
StyleDefinitions->FrontEnd`FileName[{"Report"}, "StandardReport.nb", 
  CharacterEncoding -> "UTF-8"],
ExpressionUUID->"87ad5eff-123e-4fd1-8093-497e43aaa63c"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 173, 3, 61, "Section",ExpressionUUID->"e5abd4bc-7410-43a7-b0e4-f4a71b06d082"],
Cell[756, 27, 211, 5, 36, "Input",ExpressionUUID->"9c142616-efba-4462-b026-531604d75a29"],
Cell[970, 34, 206, 5, 36, "Input",ExpressionUUID->"7164f137-e180-411b-9f7c-f6c32df31320"],
Cell[1179, 41, 1496, 25, 56, "Input",ExpressionUUID->"bdc5fccf-12ea-488c-ae86-ace93b7013bd"],
Cell[2678, 68, 1226, 18, 36, "Input",ExpressionUUID->"e6fc824d-13a0-4e4f-8d13-9693c655ca12"],
Cell[3907, 88, 18786, 367, 760, "Input",ExpressionUUID->"efce63ac-2995-401f-803a-c390548e984a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22730, 460, 335, 5, 61, "Section",ExpressionUUID->"ba65ad1f-db69-4b88-a423-9e4fb1904099"],
Cell[23068, 467, 14167, 316, 1886, "Input",ExpressionUUID->"ef82f5a6-d38a-4a59-bc34-a43b7cc6249d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37272, 788, 167, 3, 61, "Section",ExpressionUUID->"e1dce9e3-e9ed-4283-a8bf-cbaff7e3156e"],
Cell[37442, 793, 1164, 24, 110, "Input",ExpressionUUID->"667100a4-5af5-4c5b-a049-871185f7cf10"],
Cell[38609, 819, 5513, 166, 106, "Input",ExpressionUUID->"96708743-8d4c-4525-a3a0-0595b1ce61d6"],
Cell[44125, 987, 891, 23, 125, "Input",ExpressionUUID->"194bd8c7-599e-4170-8584-307678b273b5"],
Cell[45019, 1012, 11304, 239, 586, "Input",ExpressionUUID->"97c263b8-b0a9-47ff-9911-a89e83bfdb24"],
Cell[56326, 1253, 1491, 39, 219, "Input",ExpressionUUID->"05e29458-cdfa-40ad-afbf-a9583e507ded"],
Cell[57820, 1294, 895, 22, 49, "Input",ExpressionUUID->"6a509c95-ab7a-48ef-8e0c-d7206d661fb7"],
Cell[CellGroupData[{
Cell[58740, 1320, 780, 22, 87, "Input",ExpressionUUID->"b1408095-5286-4b7f-af6b-f0191f35a3bd"],
Cell[59523, 1344, 548, 11, 49, "Output",ExpressionUUID->"1d7a94f0-05e0-4d70-8204-3d76fbf95216"],
Cell[60074, 1357, 880, 19, 49, "Output",ExpressionUUID->"d3d037f6-7eb1-4b18-ad5f-216c9eda91ae"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60991, 1381, 6152, 110, 351, "Input",ExpressionUUID->"d97f39dd-75da-4c67-92ba-152bd68f8908"],
Cell[67146, 1493, 529, 14, 49, "Output",ExpressionUUID->"621f3478-edc2-42e6-a70e-1218a5b749e9"],
Cell[67678, 1509, 529, 14, 49, "Output",ExpressionUUID->"206b0352-781e-4c1f-b8ac-b7f642d9eeed"],
Cell[68210, 1525, 514, 11, 26, "Message",ExpressionUUID->"4af1a82b-6929-401f-b1a9-e9d60a692f3f"],
Cell[68727, 1538, 636, 13, 26, "Message",ExpressionUUID->"d5eb1c3f-ad4f-4cce-a6b6-fa069aa21782"],
Cell[69366, 1553, 637, 13, 26, "Message",ExpressionUUID->"b8b53e20-a103-4172-befb-671772f8fe7c"],
Cell[70006, 1568, 516, 11, 26, "Message",ExpressionUUID->"37cc10ca-982a-4649-a9be-25a0ff7d16e0"],
Cell[70525, 1581, 635, 13, 26, "Message",ExpressionUUID->"e855cc56-edbc-437e-b797-6e9595b5e377"],
Cell[71163, 1596, 530, 11, 26, "Message",ExpressionUUID->"06986157-a6be-4961-bc28-1a99bb83990f"],
Cell[71696, 1609, 515, 11, 26, "Message",ExpressionUUID->"b26e9102-a8f8-4684-b0a9-72171e310511"],
Cell[72214, 1622, 528, 11, 26, "Message",ExpressionUUID->"9ec1c1e3-239e-46c6-a5bd-fdb856b5b27d"],
Cell[72745, 1635, 235, 4, 49, "Output",ExpressionUUID->"7731917e-05c2-424c-adff-6a70ad3bb901"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73017, 1644, 181, 3, 36, "Input",ExpressionUUID->"810fdf0c-87d0-4a97-a1ef-37c4d61ce172"],
Cell[73201, 1649, 292, 5, 36, "Output",ExpressionUUID->"b110fca4-8dbf-430d-937a-7a97a80ebd3f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73530, 1659, 461, 12, 56, "Input",ExpressionUUID->"e4c8f46b-3c45-44a9-9c96-c1f340f7efed"],
Cell[73994, 1673, 1153, 21, 36, "Output",ExpressionUUID->"1e706bda-7cb3-4919-a2cd-52c349781147"]
}, Open  ]],
Cell[CellGroupData[{
Cell[75184, 1699, 263, 5, 36, "Input",ExpressionUUID->"0cab19b4-cd6f-4a36-a845-d3eaa8492b83"],
Cell[75450, 1706, 1160, 17, 36, "Output",ExpressionUUID->"af67a0f9-592c-4996-98f2-5987e0ef5a36"]
}, Open  ]],
Cell[76625, 1726, 6495, 154, 368, "Input",ExpressionUUID->"51f33504-12f1-421a-afbe-b5e4fb54c3c1"],
Cell[CellGroupData[{
Cell[83145, 1884, 212, 4, 36, "Input",ExpressionUUID->"73d3a447-74ac-419d-b8de-055eb9df9414"],
Cell[83360, 1890, 979, 21, 36, "Output",ExpressionUUID->"45462f19-5b49-4a28-84cf-67374a06ecc7"]
}, Open  ]]
}, Open  ]]
}
]
*)

