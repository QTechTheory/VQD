(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     76601,       1785]
NotebookOptionsPosition[     73352,       1725]
NotebookOutlinePosition[     73846,       1743]
CellTagsIndexPosition[     73803,       1740]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Virtual Device and questlink", "Section",
 CellChangeTimes->{{3.867828173808653*^9, 
  3.867828181020499*^9}},ExpressionUUID->"e5abd4bc-7410-43a7-b0e4-\
f4a71b06d082"],

Cell[BoxData[
 RowBox[{"SetEnvironment", "[", 
  RowBox[{"\"\<OMP_NUM_THREADS\>\"", "\[Rule]", "\"\<8\>\""}], "]"}]], "Input",\

 CellLabel->
  "In[465]:=",ExpressionUUID->"9c142616-efba-4462-b026-531604d75a29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 CellLabel->
  "In[466]:=",ExpressionUUID->"7164f137-e180-411b-9f7c-f6c32df31320"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "Import", "[", "\"\</home/cica/programs/QuESTlink/Link/QuESTlink.m\>\"", 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateLocalQuESTEnv", "[", "\"\<quest_link_cpu\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.82497505062926*^9, 3.8249750506297073`*^9}, 
   3.824994043627574*^9, 3.825001607792643*^9, {3.825001692867886*^9, 
   3.825001693910748*^9}, 3.825005541672139*^9, {3.8257703632332573`*^9, 
   3.8257703928999557`*^9}, {3.8257705549908867`*^9, 
   3.8257705572226887`*^9}, {3.827395402084569*^9, 3.827395414565299*^9}, 
   3.8273959879208593`*^9, {3.8273960394479303`*^9, 3.8273960853619223`*^9}, {
   3.8273961168062162`*^9, 3.827396123715522*^9}, {3.827396318549856*^9, 
   3.827396412632536*^9}, {3.8274045827011538`*^9, 3.82740458379325*^9}, {
   3.8278173564819393`*^9, 3.827817361228321*^9}, {3.830976734134877*^9, 
   3.8309767494625072`*^9}, {3.834480282684927*^9, 3.834480283538302*^9}, {
   3.834480426528635*^9, 3.834480438344689*^9}, {3.840643429673587*^9, 
   3.84064343214264*^9}, {3.840644090065632*^9, 3.840644110294639*^9}, {
   3.841376639126837*^9, 3.841376652890356*^9}, {3.852805051225027*^9, 
   3.852805051940732*^9}, 3.852866941489101*^9, 3.863433244574464*^9, {
   3.863444417946168*^9, 3.8634444207524557`*^9}, {3.863758485466724*^9, 
   3.8637585009226294`*^9}, {3.863763334072833*^9, 3.8637633356047773`*^9}},
 CellLabel->
  "In[467]:=",ExpressionUUID->"bdc5fccf-12ea-488c-ae86-ace93b7013bd"],

Cell[BoxData[
 RowBox[{"Get", "[", "\"\<../vqd.wl\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.840641143565943*^9, 3.840641172251192*^9}, {
   3.852799583306651*^9, 3.85279959973236*^9}, 3.8626416092550993`*^9, {
   3.8634335183180933`*^9, 3.863433525482596*^9}, {3.863433568660131*^9, 
   3.863433569874107*^9}, {3.863433692497489*^9, 3.863433694465293*^9}, {
   3.863445057138888*^9, 3.86344507880478*^9}, {3.863445347209435*^9, 
   3.8634453507921267`*^9}, {3.863445650432852*^9, 3.863445652815689*^9}, {
   3.863445897019453*^9, 3.8634458974688377`*^9}, {3.86344607759472*^9, 
   3.863446078099331*^9}, {3.863446143635272*^9, 3.863446143966124*^9}, {
   3.863446177367778*^9, 3.86344617796842*^9}, {3.8634467623389387`*^9, 
   3.863446816486045*^9}, {3.863446923713131*^9, 3.863446924990855*^9}, {
   3.863447604132453*^9, 3.8634476320572042`*^9}, {3.863448157317191*^9, 
   3.863448185412036*^9}, {3.86344848550739*^9, 3.863448486307929*^9}, {
   3.863730635263914*^9, 3.863730645543404*^9}, {3.863730806825498*^9, 
   3.863730825085904*^9}, {3.864798306500605*^9, 3.864798308030095*^9}, {
   3.864808339041327*^9, 3.864808339281568*^9}},
 CellLabel->
  "In[469]:=",ExpressionUUID->"e6fc824d-13a0-4e4f-8d13-9693c655ca12"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "SiliconDelft", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"qubitsNum", "->", "6"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"average", " ", "of", " ", "T1"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"T1", "->", 
      SuperscriptBox["10", "5"]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       SuperscriptBox["T2", "*"], " ", ":", " ", 
       RowBox[{
       "Implementation", " ", "might", " ", "be", " ", "incorrect"}]}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"T2s", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "3"}], ",", 
        RowBox[{"1", "->", " ", "2.5"}], ",", 
        RowBox[{"2", "->", " ", "3.7"}], ",", 
        RowBox[{"3", "->", " ", "3.7"}], ",", 
        RowBox[{"4", "->", " ", "5.9"}], ",", 
        RowBox[{"5", "->", " ", "5.1"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"T2", " ", "obtained", " ", "by", " ", "echo", " ", 
         RowBox[{"RX", "[", 
          RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "-", "\[Tau]", "-", 
        RowBox[{"RX", "[", "\[Pi]", "]"}], "-", "\[Tau]", "-", 
        RowBox[{"RX", "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], ",", " ", 
       RowBox[{
        RowBox[{"where", " ", "\[Tau]"}], "=", 
        RowBox[{"1", "\[Mu]s"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"T2", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "14"}], ",", 
        RowBox[{"1", "->", " ", "21.1"}], ",", 
        RowBox[{"2", "->", " ", "40.1"}], ",", 
        RowBox[{"3", "->", " ", "37.2"}], ",", 
        RowBox[{"4", "->", " ", "44.7"}], ",", 
        RowBox[{"5", "->", " ", "26.7"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"If", " ", "true"}], ",", " ", 
       RowBox[{
       "then", " ", "the", " ", "noise", " ", "model", " ", "uses", " ", 
        "T2s", " ", "otherwise", " ", "T2"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"DDActive", "->", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"EDIT", ":", " ", 
       RowBox[{
       "Qubit", " ", "frequency", " ", "of", " ", "each", " ", "qubit", " ", 
        "in", " ", "MHz"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"QubitFreq", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", 
         RowBox[{"15.62", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"1", "->", " ", 
         RowBox[{"15.88", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"2", "->", " ", 
         RowBox[{"16.3", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"3", "->", " ", 
         RowBox[{"16.1", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"4", "->", " ", 
         RowBox[{"15.9", "*", 
          SuperscriptBox["10", "3"]}]}], ",", 
        RowBox[{"5", "->", " ", 
         RowBox[{"15.69", "*", 
          SuperscriptBox["10", "3"]}]}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"rabi", " ", "frequencies", " ", "on", " ", "single", " ", 
       RowBox[{"rotations", ":", " ", 
        RowBox[{"5", " ", "is", " ", "average"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"RabiFreq", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "5"}], ",", 
        RowBox[{"1", "->", "5"}], ",", 
        RowBox[{"2", "->", "5"}], ",", 
        RowBox[{"3", "->", "5"}], ",", 
        RowBox[{"4", "->", "5"}], ",", 
        RowBox[{"5", "->", "5"}]}], "|>"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Set", " ", "the", " ", "noise", " ", "form", " ", "of", " ", "off"}], 
       "-", 
       RowBox[{"resonant", " ", "Rabi", " ", 
        RowBox[{"oscillation", ".", " ", "This"}], " ", "takes", " ", 
        "RabiFreq", " ", "information", " ", "to", " ", "produce", " ", "the",
         " ", 
        RowBox[{"noise", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"OffResonantRabi", "->", "True"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Set", " ", "the", " ", "standard", " ", "depolarising", " ", "and", 
       " ", "dephasing", " ", "passive", " ", "noise", " ", "using", " ", 
       "T1", " ", "and", " ", 
       RowBox[{"T2", "/", "T2s"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"StdPassiveNoise", "->", "True"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Fidelities", " ", "of", " ", "X"}], "-", " ", 
       RowBox[{"and", " ", "Y"}], "-", " ", 
       RowBox[{"rotations", " ", "by", " ", "random", " ", "benchmarking"}]}],
       " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FidSingleXY", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "0.9977"}], ",", 
        RowBox[{"1", "->", " ", "0.9987"}], ",", 
        RowBox[{"2", "->", " ", "0.9996"}], ",", 
        RowBox[{"3", "->", " ", "0.9988"}], ",", 
        RowBox[{"4", "->", " ", "0.9991"}], ",", 
        RowBox[{"5", "->", " ", "0.9989"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Error", " ", 
       RowBox[{"fraction", "/", "ratio"}], " ", 
       RowBox[{"{", 
        RowBox[{"depolarising", ",", " ", "dephasing"}], "}"}], " ", "sum", 
       " ", "is", " ", "either", " ", "one", " ", "or", " ", "zero"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"EFSingleXY", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", "  ", 
      RowBox[{
       RowBox[{
        RowBox[{"The", " ", "rabi", " ", "Frequency", " ", 
         RowBox[{"(", "MHz", ")"}], " ", "and", " ", "fidelities", " ", "of", 
         " ", "controlled"}], "-", "Z"}], ",", " ", 
       RowBox[{"C", "[", "Z", "]"}], ",", " ", 
       RowBox[{"nearest", "-", "neighbors"}], ",", " ", 
       RowBox[{
       "where", " ", "the", " ", "control", " ", "qubits", " ", "are", " ", 
        "the", " ", "lower", " ", 
        RowBox[{"one", ".", " ", "Keys"}], " ", "are", " ", "the", " ", 
        "control", " ", "qubits"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FreqCZ", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "12.1"}], ",", 
        RowBox[{"1", "->", " ", "11.1"}], ",", 
        RowBox[{"2", "->", " ", "6.6"}], ",", 
        RowBox[{"3", "->", " ", "9.8"}], ",", 
        RowBox[{"4", "->", " ", "5.4"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "obtained", " ", "from", " ", "a", " ", "simple", " ", "optimisation", 
       " ", "via", " ", "bell", " ", "state", " ", "fidelity"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"FidCZ", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "\[Rule]", "0.9526707113340579`"}], ",", 
        RowBox[{"1", "\[Rule]", "0.9395929490898237`"}], ",", 
        RowBox[{"2", "\[Rule]", "0.9484194291327452`"}], ",", 
        RowBox[{"3", "\[Rule]", "0.9850519102118337`"}], ",", 
        RowBox[{"4", "\[Rule]", "0.9663173858117854`"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Error", " ", 
        RowBox[{"fraction", "/", "ratio"}], " ", 
        RowBox[{"{", 
         RowBox[{"depolarising", ",", " ", "dephasing"}], "}"}], " ", "of", 
        " ", "controled"}], "-", 
       RowBox[{"Rz", " ", "rotation"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"EFCZ", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Crosstalks", " ", "error", " ", 
        RowBox[{"(", 
         RowBox[{"C", "-", 
          RowBox[{"Rz", "[", "ex", "]"}]}], ")"}], "on", " ", "the", " ", 
        "passive", " ", "qubits", " ", "when", " ", "applying", " ", "CZ", 
        " ", "gates"}], ";", 
       RowBox[{
        RowBox[{
        "square", " ", "matrix", " ", "with", " ", "dims", " ", "nqubit"}], 
        "-", "2"}]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ExchangeRotOn", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "0", ",", "0.023", ",", " ", "0.018", " ", ",", "0.03", ",", " ", 
          "0.04"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.05", " ", ",", "0", ",", "0.03", ",", " ", "0.03", ",", " ", 
          "0.04"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.05", ",", " ", "0.03", " ", ",", "0", ",", "0.07", ",", " ", 
          "0.042"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.038", " ", ",", "0.03", " ", ",", "0.031", ",", "0", " ", ",", 
          "0.25"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.033", ",", " ", "0.03", " ", ",", "0.02", ",", " ", "0.03", ",", 
          "0"}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Crosstalks", " ", "error", " ", 
       RowBox[{"(", 
        RowBox[{"C", "-", 
         RowBox[{"Rz", "[", "ex", "]"}]}], ")"}], "on", " ", "the", " ", 
       "passive", " ", "qubits", " ", "when", " ", "no", " ", "CZ", " ", 
       "gates", " ", "applied"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ExchangeRotOff", "->", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"0", "->", "0.039"}], ",", 
        RowBox[{"1", "->", " ", "0.015"}], " ", ",", 
        RowBox[{"2", "->", "0.03"}], " ", ",", 
        RowBox[{"3", "->", "0.02"}], ",", 
        RowBox[{"4", "->", " ", "0.028"}]}], "|>"}]}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Single", " ", "readout", " ", "fidelity", " ", "and", " ", "duration",
         " ", "of", " ", "the", " ", "edge", " ", "qubits"}], ",", " ", 
       RowBox[{"ie", " ", "01", " ", "and", " ", "56"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"FidRead", "->", "0.99"}], ",", "\[IndentingNewLine]", 
     RowBox[{"DurRead", "->", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"RepeatRead", "->", "2"}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{
  3.868008276450292*^9, 3.86800843882782*^9, {3.86800950750327*^9, 
   3.868009515372327*^9}, 3.86808362209037*^9, 3.871346692628646*^9},
 CellLabel->
  "In[470]:=",ExpressionUUID->"a071e88b-5fbc-4f67-889f-f6f2c5755a29"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simple noise parameters optimisation in VQD", "Section",
 CellChangeTimes->{{3.86740366966924*^9, 3.867403679786591*^9}, {
  3.8678299526691647`*^9, 3.867829953994721*^9}, {3.867991354651064*^9, 
  3.867991366964538*^9}, {3.868005068781521*^9, 
  3.8680050695264597`*^9}},ExpressionUUID->"ba65ad1f-db69-4b88-a423-\
9e4fb1904099"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "GradDescent", "]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"GradDescent", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GradDescent", "[", 
    RowBox[{"params_", ",", "objf_", ",", "conf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "cost", ",", "basecost", ",", "grad", ",", "paramst", ",", "paramst2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"basecost", "=", 
       RowBox[{"objf", "[", "params", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grad", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"paramst", "=", "params"}], ";", "\[IndentingNewLine]", 
          RowBox[{"paramst2", "=", "params"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"paramst", "[", "k", "]"}], "=", 
           RowBox[{"N", "[", 
            RowBox[{
             RowBox[{"paramst", "[", "k", "]"}], "+", 
             RowBox[{"conf", "[", "\"\<d\[Theta]\>\"", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"paramst2", "[", "k", "]"}], "=", 
           RowBox[{"N", "[", 
            RowBox[{
             RowBox[{"paramst", "[", "k", "]"}], "-", 
             RowBox[{"conf", "[", "\"\<d\[Theta]\>\"", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"N", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"objf", "[", "paramst", "]"}], "-", 
              RowBox[{"objf", "[", "paramst2", "]"}]}], ")"}], "*", 
            RowBox[{"0.5", "/", 
             RowBox[{"conf", "[", "\"\<d\[Theta]\>\"", "]"}]}]}], " ", 
           "]"}]}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", 
           RowBox[{"Keys", "@", "params"}]}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"UpdateCost", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UpdateCost", "[", 
    RowBox[{"params_", ",", "objf_", ",", "conf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grad", ",", " ", "beststep", ",", "gradstep", ",", "tparams", ",", 
       "cbest", ",", "cnew"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"beststep", "=", 
       RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gradstep", "=", "beststep"}], ";", "\[IndentingNewLine]", 
      RowBox[{"grad", "=", 
       RowBox[{"GradDescent", "[", 
        RowBox[{"params", ",", "objf", ",", "conf"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"tparams", "=", 
       RowBox[{"Normal", "@", "params"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tparams", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "-=", 
       RowBox[{
        RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], "*", "grad"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cbest", "=", 
       RowBox[{"objf", "[", "tparams", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"conf", "[", "\"\<gradstepmultiply\>\"", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{"True", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"gradstep", "*=", 
             RowBox[{"conf", "[", "\"\<gradstepmultiply\>\"", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"tparams", "=", 
             RowBox[{"Normal", "@", "params"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{
             RowBox[{"tparams", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "-=", 
             RowBox[{"gradstep", "*", "grad"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"cnew", "=", 
             RowBox[{"objf", "[", "tparams", "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"cnew", ">=", "cbest"}], ",", " ", 
              RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"cbest", "=", "cnew"}], ";", "\[IndentingNewLine]", 
            RowBox[{"beststep", "=", "gradstep"}]}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tparams", "=", 
       RowBox[{"Normal", "@", "params"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tparams", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "-=", 
       RowBox[{"beststep", "*", "grad"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"params", "=", 
       RowBox[{"Association", "@", "tparams"}]}], ";", "\[IndentingNewLine]", 
      "cbest"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParamsFit", "::", "usage"}], "=", 
   "\"\<ParamsFit[device, conf]. Parameterisation fitting.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"ParamsFit", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParamsFit", "[", 
   RowBox[{"params_", ",", "objf_", ",", "conf_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "cost", ",", " ", "iter", ",", "dcost", ",", "oldcost", ",", "oldparams",
       ",", "paramsinit", ",", 
      RowBox[{"initgradstep", "=", 
       RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}]}], ",", 
      RowBox[{"converge", "=", "0"}], ",", 
      RowBox[{"costlist", "=", 
       RowBox[{"{", "}"}]}], ",", "costinit", ",", 
      RowBox[{"fail", "=", "0"}], ",", 
      RowBox[{"maxfail", "=", "10"}], ",", 
      RowBox[{"msg", "=", "\"\<\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iter", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"cost", "=", 
      RowBox[{"objf", "[", "params", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"costinit", "=", "cost"}], ";", 
     RowBox[{"paramsinit", "=", "params"}], ";", "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"costlist", ",", "cost"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{"True", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"oldcost", "=", "cost"}], ";", "\[IndentingNewLine]", 
           RowBox[{"oldparams", "=", "params"}], ";", "\[IndentingNewLine]", 
           RowBox[{"cost", "=", 
            RowBox[{"UpdateCost", "[", 
             RowBox[{"params", ",", "objf", ",", "conf"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"dcost", "=", 
            RowBox[{"cost", "-", "oldcost"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"dcost", ">=", "0"}], "&&", 
              RowBox[{"iter", ">", "1"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"revert", " ", "to", " ", "old", " ", "cond"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"cost", ",", "params"}], "}"}], "=", 
               RowBox[{"{", 
                RowBox[{"oldcost", ",", "oldparams"}], "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"fail", "++"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], "*=", "0.5"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"msg", "=", 
               RowBox[{"\"\<fail \>\"", "<>", 
                RowBox[{"ToString", "[", "fail", "]"}], "<>", 
                "\"\< times due to increasing cost. Set gradstep to \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                  RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], ",", 
                  "TraditionalForm"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"fail", ">=", "maxfail"}], ",", " ", 
                RowBox[{"(*", 
                 RowBox[{"consecutive", " ", "maxfails"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                 "Print", "[", 
                  "\"\<Reach consecutive maxfails. Optimisation fails\>\"", 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Break", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
               "]"}]}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"fail", "=", "0"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], "=", 
               "initgradstep"}], ";", "\[IndentingNewLine]", 
              RowBox[{"msg", "=", 
               RowBox[{
               "\"\<Recovered from fail. Set gradstep to \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{
                  RowBox[{"conf", "[", "\"\<gradstep\>\"", "]"}], ",", 
                  "TraditionalForm"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"cost", "<=", 
              RowBox[{"conf", "[", "\"\<costfin\>\"", "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<seems converged to dcost=\>\"", ",", "dcost"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"++", "iter"}], ">", " ", 
                RowBox[{"conf", "[", "\"\<maxiter\>\"", "]"}]}], ")"}], "||", 
              
              RowBox[{"converge", ">=", 
               RowBox[{"conf", "[", "\"\<convergenum\>\"", "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<Reach maxiter or too flat: dcost=\>\"", ",", "dcost"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"costlist", ",", "cost"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"Column", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<cost=\>\"", "<>", 
           RowBox[{"ToString", "@", "cost"}]}], ",", 
          RowBox[{"\"\<iter=\>\"", "<>", 
           RowBox[{"ToString", "@", "iter"}]}], ",", "msg"}], "}"}]}]}], 
      "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"cost", ">=", "costinit"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Optimisation have failed, use the initial parameter guess\>\"", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"cost", ",", "params"}], "}"}], "=", 
         RowBox[{"{", 
          RowBox[{"costinit", ",", "paramsinit"}], "}"}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"costlist", ",", "cost"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"ListPlot", "[", "costlist", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"objf", "[", "params", "]"}], ",", "params"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0n84FHYcB3AdZbTucpXR/A6Z7JjHzJOoXfnZ4ZIw3cn8eHK5ubSW5zk6
VnfkLNJY6EFaKcIjI9kKIaI9dvNwtkMPlR+Z1dlYzzx7zr7v7x+f5/V8Pv98
nvfn+djGS8KTGHp6egJSsGlkIuKaavHThYVPPoOPahlxcOqIbTwcv7GtHe6L
LaKG/j3cAe2PePXB+qLVAVii9tdAqXRyGo6YLM3Cd3O2M6qJvR079KHgXEIE
dNZci4LlsToh5F5elwwXb6WUQj+r8jJYt0fDuk584yUyg0x2iCWMNo+wgv0m
/W6wT+joCdURKQFQ915RIOyaO8aD/tzwcOg0PBoJsw0GomHc7zoBbGxtFsKo
UJFBLfGn3izqap5qIyxpyzeDiSWltlDTnmEHtW2MD2Cg+F8OZNrJPWBupoq6
68K3u6FYeNQHtixd2A9Hc385AJ83rMzfI1qklb+CkcP8ZXi2iauDJ/Z+adBG
LO6Wb4BnytfZ075RyYWBj2IC4RA/Mwj+4KgIg/frjNKhb65aCrNLU7+GU3qu
l2Avp4Ia/Y//IBxhnX8Kl9PT5geIm6XsBWh4k204SKydj6fee/uhOXzZeWUH
nSdnuUJ3rakH1BzS+MJ5M4kfHPvjmyA48TCSD7MTqkTQLLieqp2UTEOBIlIL
25TKLU/xB/azW2Ed58VHZr+SvHYe7tDDWd8b1hdY+cE583we3Bf7Mx/6GrnH
wE4vPlWsWRLBLsWCGDItC2RwatcaVbuqVEC2XVYO7CjuKYQFrKAy6P7VWhV8
1q9fDd/ZlDkETYtuUTdvrWGaEyP9dNugrIFvAV92RlGjXUYyLIizNw/nQacA
gdqSqHlRPQm3u96ehv/J5AvwYnjuSSvizqOv0yEzp7IDpjYX9kDGuBXDmphw
+3PqcB7PFt6t8foY7n9S4wsPjH+xFz7z9pbZEHXGklyo7PitDJ4Ku3wVyvKt
e+H6FGU/fP2q6ZI9ct3ponLntJVQ5vm4EXoPe3XBLQE9PTDmeeEYFPLLqdfV
5hsdiLvHlqnNglUWnDeuYEMXnpTjSLzhkOAGT8yc9ISi+5V7oM2p5VBoffpt
GHQObjoO/3w/MQ36+3Qe3Ems+jGEB7VnfKd4uOe5nhlo80aaEULcoBhVwOox
VgV8wJHWQvHh4gaoc3G6C539Yzshf/JiN2ySsA9+T/SbyT8E2x9/dxZOiFqp
qUY+56GJRCiHho7y5T7ikFizAltrTq/BCMsU035iS5LcAcavb6WKNlmOPyF2
xzlRw1Uti5Az+oDKtEgeddOQfXdqqYkPjf+CxcdY1OCWwYQkYvaK6jj8Hwad
Klw=
  "],
 CellLabel->
  "In[471]:=",ExpressionUUID->"ef82f5a6-d38a-4a59-bc34-a43b7cc6249d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Fitting the Bell state ", "Section",
 CellChangeTimes->{{3.867524667987578*^9, 
  3.86752467595494*^9}},ExpressionUUID->"e1dce9e3-e9ed-4283-a8bf-\
cbaff7e3156e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "a", " ", "set", " ", "of", " ", "random", " ", "initial", " ", "states", 
    " ", "\[IndentingNewLine]", "It", " ", 
    RowBox[{"doesn", "'"}], "t", " ", "work", " ", "for", " ", "a", " ", 
    RowBox[{"set", ".", " ", "Cannot"}], " ", "handle", " ", "shot", " ", 
    RowBox[{"noise", "?"}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[Rho]mat", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"RandomMixState", "[", "6", "]"}], ",", 
      RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8677471854549513`*^9, 3.867747206113109*^9}, {
  3.867751111783306*^9, 3.867751113707391*^9}, {3.8678317311839943`*^9, 
  3.867831735192943*^9}, {3.867831772537204*^9, 3.8678317829259367`*^9}, {
  3.8678319243364553`*^9, 3.867831925098909*^9}, {3.867831979607675*^9, 
  3.8678320117316723`*^9}, {3.8678320686316853`*^9, 3.8678320691557093`*^9}, {
  3.867832352460476*^9, 3.867832381654084*^9}},
 CellLabel->
  "In[479]:=",ExpressionUUID->"667100a4-5af5-4c5b-a049-871185f7cf10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"bellcirc\[Rho]", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<01\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{
          RowBox[{"-", "\[Pi]"}], "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<12\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "2"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "1"], "[", 
         SubscriptBox["Z", "2"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "2"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<23\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "2"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "3"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "2"], "[", 
         SubscriptBox["Z", "3"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "3"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<34\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "3"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "4"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "3"], "[", 
         SubscriptBox["Z", "4"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "4"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<45\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "4"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "5"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "4"], "[", 
         SubscriptBox["Z", "5"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "5"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}]}], "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bellcirc\[Psi]", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<01\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["X", "0"], ",", 
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{
          RowBox[{"-", "\[Pi]"}], "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<12\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<23\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<34\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"\"\<45\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["X", "1"], ",", 
        RowBox[{
         SubscriptBox["Rx", "0"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", 
        RowBox[{
         SubscriptBox["C", "0"], "[", 
         SubscriptBox["Z", "1"], "]"}], ",", 
        RowBox[{
         SubscriptBox["Rx", "1"], "[", 
         RowBox[{"\[Pi]", "/", "2"}], "]"}]}], "}"}]}]}], "|>"}]}], 
  ";"}]}], "Input",
 CellLabel->
  "In[480]:=",ExpressionUUID->"96708743-8d4c-4525-a3a0-0595b1ce61d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Rho]", "=", 
   RowBox[{"CreateDensityQureg", "[", "6", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]2", "=", 
   RowBox[{"CreateDensityQureg", "[", "2", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]", "=", 
   RowBox[{"CreateQureg", "[", "6", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]2", "=", 
   RowBox[{"CreateQureg", "[", "2", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.868083642017118*^9, 3.868083649290572*^9}, {
  3.871347683026083*^9, 3.871347684682191*^9}},
 CellLabel->
  "In[482]:=",ExpressionUUID->"194bd8c7-599e-4170-8584-307678b273b5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"noisyAnsatz", "::", "usage"}], "=", 
   "\"\<noisyAnsatz[ansatz, conf]. Return the noise-decorated gates.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"noisyAnsatz", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"noisyAnsatz", "[", 
    RowBox[{"ansatz_", ",", "conf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "dev", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dev", "=", 
       RowBox[{"conf", "[", "\"\<device\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"copy", " ", "the", " ", "virtual", " ", "device"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ExtractCircuit", "@", 
       RowBox[{"GetNoisyForm", "[", 
        RowBox[{"ansatz", ",", " ", "dev", ",", " ", 
         RowBox[{"ReplaceAliases", "->", "True"}], ",", " ", 
         RowBox[{"Parallel", "->", 
          RowBox[{"conf", "[", "\"\<parallel\>\"", "]"}]}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"concurence", "[", "\[Rho]_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "eigv", ",", "\[Rho]m", ",", "\[Rho]ms", ",", "\[Rho]t", ",", "nq", ",",
        "pauliy"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Rho]m", "=", 
       RowBox[{"GetQuregMatrix", "@", "\[Rho]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nq", "=", 
       RowBox[{"IntegerPart", "@", 
        RowBox[{"Log2", "@", 
         RowBox[{"Length", "@", "\[Rho]m"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]ms", "=", 
       RowBox[{"MatrixPower", "[", 
        RowBox[{"\[Rho]m", ",", 
         RowBox[{"1", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pauliy", "=", 
       RowBox[{"CalcCircuitMatrix", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["Y", "#"], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{"nq", "-", "1"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Rho]t", "=", 
       RowBox[{"pauliy", ".", 
        RowBox[{"Conjugate", "[", "\[Rho]m", "]"}], ".", "pauliy"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"eigv", "=", 
       RowBox[{"Reverse", "@", 
        RowBox[{"Sort", "[", 
         RowBox[{"Chop", "@", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"MatrixPower", "[", 
            RowBox[{
             RowBox[{"\[Rho]ms", ".", "\[Rho]t", ".", "\[Rho]ms"}], ",", 
             RowBox[{"1", "/", "2"}]}], "]"}], "]"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Max", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"eigv", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "-", 
         RowBox[{"Total", "@", 
          RowBox[{"eigv", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}]}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bellcost", "[", "params_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "init", ",", "qubits", ",", "plot", ",", "codes", ",", "fidtarget", ",", 
      "conctarget", ",", "opt", ",", "noisycirc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"codes", "=", 
      RowBox[{"ReplaceList", "[", 
       RowBox[{
        RowBox[{"Sort", "@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "5"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p___", ",", "a_", ",", "b_", ",", "q___"}], "}"}], ":>", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}], ",", "\"\<\>\""}], "]"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fidtarget", "=", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<01\>\"", "->", "89.2"}], ",", 
        RowBox[{"\"\<12\>\"", "->", "90.1"}], ",", 
        RowBox[{"\"\<23\>\"", "->", "88.3"}], ",", 
        RowBox[{"\"\<34\>\"", "->", "95.6"}], ",", 
        RowBox[{"\"\<45\>\"", "->", "94.1"}]}], "|>"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"conctarget", "=", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<01\>\"", "->", "86.7"}], ",", 
        RowBox[{"\"\<12\>\"", "->", "83.9"}], ",", 
        RowBox[{"\"\<23\>\"", "->", "87.9"}], ",", 
        RowBox[{"\"\<34\>\"", "->", "94.9"}], ",", 
        RowBox[{"\"\<45\>\"", "->", "90.6"}]}], "|>"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"opt", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"FidCZ", "\[Rule]", 
         RowBox[{"\[LeftAssociation]", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            SubscriptBox["\[Theta]", "0"]}], ",", 
           RowBox[{"1", "\[Rule]", 
            SubscriptBox["\[Theta]", "1"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            SubscriptBox["\[Theta]", "2"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            SubscriptBox["\[Theta]", "3"]}], ",", 
           RowBox[{"4", "\[Rule]", 
            SubscriptBox["\[Theta]", "4"]}]}], "\[RightAssociation]"}]}], 
        "}"}], "/.", "params"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Mean", "@", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"init", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"qubits", "=", 
          RowBox[{"ToExpression", "@", 
           RowBox[{"StringSplit", "[", 
            RowBox[{"code", ",", "\"\<\>\""}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"Intersection", "[", 
              RowBox[{"qubits", ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ">", 
            "0"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"init", ",", 
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["Init", 
                RowBox[{"0", ",", "1", ",", "2"}]], ",", 
               SubscriptBox["Init", 
                RowBox[{"0", ",", "1", ",", "2"}]]}], "}"}]}], "]"}]}], "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"Intersection", "[", 
              RowBox[{"qubits", ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "]"}]}], ">", 
            "0"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"init", ",", 
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["Init", 
                RowBox[{"3", ",", "4", ",", "5"}]], ",", 
               SubscriptBox["Init", 
                RowBox[{"3", ",", "4", ",", "5"}]]}], "}"}]}], "]"}]}], "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"SetQuregMatrix", "[", 
          RowBox[{"\[Rho]", ",", 
           RowBox[{"RandomChoice", "[", "\[Rho]mat", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"noisycirc", "=", 
          RowBox[{"ExtractCircuit", "@", 
           RowBox[{"GetNoisyForm", "[", 
            RowBox[{
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{"init", ",", 
                RowBox[{"bellcirc\[Rho]", "[", "code", "]"}]}], "}"}]}], ",", 
             
             RowBox[{"SiliconDelft", "[", 
              RowBox[{"Sequence", "@@", "opt"}], "]"}], ",", " ", 
             RowBox[{"ReplaceAliases", "->", "True"}], ",", " ", 
             RowBox[{"Parallel", "->", 
              RowBox[{"conf", "[", "\"\<parallel\>\"", "]"}]}]}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"noisycirc", "=", 
          RowBox[{"SimplifyCircuit", "[", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{"noisycirc", ",", 
               RowBox[{
                SubscriptBox["Depol", "__"], "[", "0.", "]"}]}], "]"}], ",", 
             RowBox[{
              SubscriptBox["Deph", "__"], "[", "0.", "]"}]}], "]"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"ApplyCircuit", "[", 
          RowBox[{"\[Rho]", ",", "noisycirc"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"SetQuregMatrix", "[", 
          RowBox[{"\[Rho]2", ",", 
           RowBox[{"PartialTrace", "[", 
            RowBox[{"\[Rho]", ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"Complement", "[", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", "5"}], "]"}], ",", "qubits"}], "]"}]}]}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ApplyCircuit", "[", 
          RowBox[{
           RowBox[{"InitZeroState", "@", "\[Psi]2"}], ",", 
           RowBox[{"bellcirc\[Psi]", "[", "code", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"0.9", "*", 
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"CalcFidelity", "[", 
               RowBox[{"\[Rho]2", ",", "\[Psi]2"}], "]"}], "*", "100"}], "-", 
             
             RowBox[{"fidtarget", "[", "code", "]"}]}], "]"}]}], "+", 
          RowBox[{"0.1", 
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"concurence", "[", "\[Rho]2", "]"}], "*", "100"}], "-", 
             
             RowBox[{"conctarget", "[", "code", "]"}]}], "]"}]}]}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"code", ",", "codes"}], "}"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.825267110790401*^9, 3.825267143982016*^9}, {
   3.82526720407201*^9, 3.825267467400854*^9}, {3.825267501702174*^9, 
   3.82526756076999*^9}, {3.825496944903048*^9, 3.825497017484922*^9}, {
   3.825497146161373*^9, 3.825497348871545*^9}, {3.8254973796165*^9, 
   3.825497399324679*^9}, {3.8254974806505136`*^9, 3.825497490600483*^9}, {
   3.8254979908864927`*^9, 3.825498082450001*^9}, 3.825499029490715*^9, {
   3.825545452994638*^9, 3.825545456200333*^9}, {3.825660460013022*^9, 
   3.825660460789646*^9}, {3.825665157718223*^9, 3.825665158522024*^9}, {
   3.825665304807225*^9, 3.825665310440206*^9}, 3.825668265294799*^9, {
   3.825668337811079*^9, 3.825668352678597*^9}, {3.825670066163863*^9, 
   3.825670084399976*^9}, {3.8256702560838423`*^9, 3.825670265614257*^9}, {
   3.825673300556446*^9, 3.825673307860298*^9}, {3.8257722934121513`*^9, 
   3.825772295131913*^9}, {3.826094093102723*^9, 3.826094093366527*^9}, {
   3.826119278388644*^9, 3.8261192959062643`*^9}, {3.826119356729138*^9, 
   3.826119364011222*^9}, {3.826128514454879*^9, 3.82612851491475*^9}, {
   3.8261307804965687`*^9, 3.8261308202093163`*^9}, {3.82613092003253*^9, 
   3.826130922614195*^9}, {3.8297372286987267`*^9, 3.8297372585806503`*^9}, {
   3.829737311870933*^9, 3.829737340579496*^9}, {3.829739266861483*^9, 
   3.8297392939617043`*^9}, {3.851147187480413*^9, 3.851147280471786*^9}, {
   3.851160511438092*^9, 3.851160515543365*^9}, {3.852264620098432*^9, 
   3.852264626164201*^9}, {3.866027567230999*^9, 3.8660276326302223`*^9}, {
   3.8660276657256413`*^9, 3.86602775709483*^9}, {3.866028031786592*^9, 
   3.8660280330596027`*^9}, {3.866028238687357*^9, 3.866028464791641*^9}, {
   3.866028516480823*^9, 3.8660286009604683`*^9}, {3.8660288006943827`*^9, 
   3.866028808934939*^9}, {3.866036777931102*^9, 3.866036786401905*^9}, {
   3.8660644674189587`*^9, 3.866064467916654*^9}, {3.8683475527831*^9, 
   3.868347575591151*^9}, {3.868445819596507*^9, 3.868445821785376*^9}, {
   3.868522226412394*^9, 3.868522247318428*^9}, {3.8685250749534883`*^9, 
   3.8685251299914007`*^9}, {3.868525256512422*^9, 3.868525338944009*^9}, {
   3.868525382137167*^9, 3.8685254634460373`*^9}, {3.8685255016061*^9, 
   3.8685255719818287`*^9}, {3.868527069893175*^9, 3.8685271095538073`*^9}, 
   3.868529489931985*^9, {3.8685299429584837`*^9, 3.868529961753438*^9}, {
   3.8685305180249453`*^9, 3.868530524404146*^9}, {3.868530590687324*^9, 
   3.8685306963552732`*^9}, {3.868602306108157*^9, 3.8686024518756437`*^9}, {
   3.868603125939369*^9, 3.868603216906681*^9}, {3.869051877727064*^9, 
   3.8690519082164307`*^9}, {3.869052696405917*^9, 3.869052762053029*^9}, {
   3.869052818645396*^9, 3.869052924521402*^9}, {3.8690530038393583`*^9, 
   3.8690530579575577`*^9}, {3.871029686169116*^9, 3.871029692450163*^9}, {
   3.871030359307041*^9, 3.871030380140921*^9}, {3.871030428094634*^9, 
   3.8710304318180923`*^9}, {3.871030517201104*^9, 3.871030578208631*^9}, {
   3.87132820279539*^9, 3.871328207636612*^9}, {3.871347694407195*^9, 
   3.871347696567253*^9}, {3.871347772598177*^9, 3.8713477758696213`*^9}, {
   3.871347991851853*^9, 3.871347996042152*^9}, {3.8713480363381653`*^9, 
   3.871348051364788*^9}, {3.87134809227966*^9, 3.871348092444755*^9}, 
   3.8713481599604177`*^9, {3.871348388818915*^9, 3.8713484080671167`*^9}, {
   3.871348505076089*^9, 3.8713485052751303`*^9}, {3.871442206893854*^9, 
   3.871442216263324*^9}, {3.8725984235292253`*^9, 3.872598435385549*^9}, {
   3.8725985200630693`*^9, 3.872598520443049*^9}, {3.872598854713922*^9, 
   3.8725988596128283`*^9}},
 CellLabel->
  "In[486]:=",ExpressionUUID->"97c263b8-b0a9-47ff-9911-a89e83bfdb24"],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"shock", ",", "HoldFirst"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shock", "[", 
   RowBox[{"params_", ",", "d\[Theta]_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "rands", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"rands", "=", 
        RowBox[{
         RowBox[{"RandomChoice", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "*", 
         "d\[Theta]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"params", "[", "k", "]"}], "+", "rands"}], ")"}], ">=", 
          "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"params", "[", "k", "]"}], "+=", "rands"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"params", "[", "k", "]"}], "-=", "rands"}]}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", 
        RowBox[{"Keys", "@", "params"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.868197059546958*^9, 3.868197130512484*^9}, {
  3.8713485955075607`*^9, 3.871348745579968*^9}},
 CellLabel->
  "In[491]:=",ExpressionUUID->"05e29458-cdfa-40ad-afbf-a9583e507ded"],

Cell[BoxData[
 RowBox[{
  RowBox[{"params", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Theta]", "0"], "\[Rule]", "0.95"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "1"], "\[Rule]", "0.94"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "2"], "\[Rule]", "0.935"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "3"], "\[Rule]", "0.96"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "4"], "\[Rule]", "0.97"}]}], "|>"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.871347709399486*^9, 3.8713477372813387`*^9}, {
  3.871347853778796*^9, 3.871347856384119*^9}, {3.871347942769764*^9, 
  3.8713479439036007`*^9}, {3.871349693730463*^9, 3.871349705727961*^9}, {
  3.8714422288388147`*^9, 3.871442243475116*^9}, {3.872598467911631*^9, 
  3.872598479665348*^9}},
 CellLabel->
  "In[493]:=",ExpressionUUID->"6a509c95-ab7a-48ef-8e0c-d7206d661fb7"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"confinit", "=", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<nqubits\>\"", "->", "6"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<maxiter\>\"", "->", "1000"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<gradstep\>\"", "->", 
       SuperscriptBox["10", 
        RowBox[{"-", "4"}]]}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<gradstepmultiply\>\"", "->", "False"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"delta", " ", "params"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\"\<d\[Theta]\>\"", "->", 
       SuperscriptBox["10", 
        RowBox[{"-", "6"}]]}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<convergenum\>\"", "->", "10"}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<costfin\>\"", "->", 
       SuperscriptBox["10", 
        RowBox[{"-", "8"}]]}]}], "\[IndentingNewLine]", "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"conf", "=", "confinit"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"cost", ",", "params"}], "}"}], "=", 
   RowBox[{"ParamsFit", "[", 
    RowBox[{"params", ",", "bellcost", ",", "conf"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.867478584210462*^9, 3.867478614436969*^9}, 
   3.867563769372993*^9, {3.8677217008942633`*^9, 3.867721701190997*^9}, 
   3.8677221085928917`*^9, {3.867722184761245*^9, 3.867722192358831*^9}, {
   3.867722406702756*^9, 3.867722411107815*^9}, {3.867722469619976*^9, 
   3.86772246976268*^9}, {3.867722610411024*^9, 3.867722611760829*^9}, {
   3.867722856605383*^9, 3.867722872136366*^9}, 3.8677229999323473`*^9, {
   3.8677234115927134`*^9, 3.8677234172291393`*^9}, {3.867723749607395*^9, 
   3.867723763081842*^9}, {3.867723865840068*^9, 3.8677238662760677`*^9}, 
   3.867724006895512*^9, 3.867724089636261*^9, {3.867735488745541*^9, 
   3.867735513009944*^9}, {3.867736499178773*^9, 3.867736509969434*^9}, {
   3.867739505777604*^9, 3.867739521001072*^9}, {3.867739567362053*^9, 
   3.867739590124502*^9}, {3.8677396446240253`*^9, 3.867739666712409*^9}, {
   3.867739716022945*^9, 3.86773971788547*^9}, {3.8677401297487183`*^9, 
   3.86774013018883*^9}, {3.867740332134946*^9, 3.867740348591604*^9}, {
   3.867747274990309*^9, 3.867747275355605*^9}, {3.867747386981043*^9, 
   3.8677474223156643`*^9}, {3.86774747203686*^9, 3.86774747716665*^9}, {
   3.867747532092052*^9, 3.867747533236147*^9}, {3.867747716475049*^9, 
   3.8677478236621103`*^9}, {3.867748080215173*^9, 3.867748090647698*^9}, {
   3.8677481423230047`*^9, 3.867748142550969*^9}, 3.867748212409244*^9, {
   3.867748299103956*^9, 3.867748311840644*^9}, {3.867748355105878*^9, 
   3.867748407870962*^9}, {3.86774851110168*^9, 3.867748592659658*^9}, 
   3.8677486294081173`*^9, {3.867748723540269*^9, 3.867748750995431*^9}, {
   3.867750721431233*^9, 3.8677507345673113`*^9}, {3.867750797191193*^9, 
   3.867750816133525*^9}, {3.867750890955744*^9, 3.86775090455231*^9}, {
   3.867751099067903*^9, 3.867751107461033*^9}, 3.867751199638785*^9, {
   3.867751554105598*^9, 3.867751568457637*^9}, {3.8677517126154346`*^9, 
   3.867751739619873*^9}, {3.867752866062779*^9, 3.8677528671215754`*^9}, {
   3.8677533380256357`*^9, 3.867753340724971*^9}, {3.867754369231785*^9, 
   3.867754389743754*^9}, 3.867754651480399*^9, {3.86776588088827*^9, 
   3.867765882699514*^9}, {3.867828236208877*^9, 3.867828236631351*^9}, 
   3.8678294620042753`*^9, {3.867829523474901*^9, 3.867829527621636*^9}, {
   3.8678297896958227`*^9, 3.867829789886693*^9}, 3.8678298466216927`*^9, {
   3.867829908950405*^9, 3.867829909117131*^9}, {3.867830078532432*^9, 
   3.867830083057901*^9}, {3.8678303863981037`*^9, 3.86783038875496*^9}, {
   3.8678307598769627`*^9, 3.867830766207695*^9}, 3.8678312167034597`*^9, {
   3.8678318709610147`*^9, 3.867831906593748*^9}, {3.867831975434885*^9, 
   3.8678319756133137`*^9}, {3.867832019595372*^9, 3.867832039816478*^9}, {
   3.8680061607920723`*^9, 3.86800617172171*^9}, {3.8680068684215727`*^9, 
   3.868006869365733*^9}, {3.868008337279924*^9, 3.868008345251088*^9}, {
   3.86800841749784*^9, 3.8680084184179277`*^9}, {3.8680086535410423`*^9, 
   3.868008691129301*^9}, {3.8680095270254297`*^9, 3.868009527205689*^9}, {
   3.868077159831731*^9, 3.868077172041079*^9}, {3.868077254909052*^9, 
   3.868077320317895*^9}, {3.868077392287406*^9, 3.868077397613968*^9}, {
   3.868079825265657*^9, 3.86807982544315*^9}, {3.8680803418163757`*^9, 
   3.868080354269348*^9}, {3.868080615425458*^9, 3.8680806230031023`*^9}, {
   3.86808066288321*^9, 3.868080668553878*^9}, {3.8680838749111767`*^9, 
   3.868083902459324*^9}, {3.8680840052154284`*^9, 3.86808400600381*^9}, {
   3.868086703955998*^9, 3.868086705489009*^9}, {3.868086870048427*^9, 
   3.868086949275113*^9}, {3.868087280594368*^9, 3.8680872936134033`*^9}, {
   3.868196962870204*^9, 3.868196979660488*^9}, {3.868197160238612*^9, 
   3.868197160883505*^9}, {3.868197256510895*^9, 3.868197285078189*^9}, {
   3.868197396081946*^9, 3.8681974190358887`*^9}, {3.868197522369574*^9, 
   3.868197530209793*^9}, {3.871348474541276*^9, 3.871348475228479*^9}, {
   3.87134875059665*^9, 3.871348757100319*^9}, {3.871353783929513*^9, 
   3.871353797734386*^9}, {3.871355551259571*^9, 3.871355573535534*^9}},
 CellLabel->
  "In[494]:=",ExpressionUUID->"d97f39dd-75da-4c67-92ba-152bd68f8908"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Reach consecutive maxfails. Optimisation fails\"\>"], \
"Print",
 CellChangeTimes->{3.8726023265319433`*^9},
 CellLabel->
  "During evaluation of \
In[494]:=",ExpressionUUID->"b0151009-67b3-47b9-b525-d604be4eceb8"],

Cell[BoxData[
 GraphicsBox[{{}, 
   {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.007333333333333334], 
    AbsoluteThickness[1.6], 
    StyleBox[PointBox[CompressedData["
1:eJxd1HlQVVUcB/CjY5ZG+jBDmzHnok055kKiYkbyzV3UfLigpOQVBARcHgIu
5ejREbTcnkVlLnnNyNwaJCty61paRmpPaSFNfYCRlMtrxcrBbDxnmvO9/9z5
vO9853t//7zIlFmj0xoLIRY3EuK/9+0nFNei4erC/D6NoH5AbKsVkU3bC+W7
8O6pLcvWJTfE3bYHBdM2P3tg7Q3l1phXVShOh/2j3BYDNg/YMKzZ38rtUDam
U5uPNl5XtrBi5Abf7rh65Q7YM/po111d/lR+EHV1xe8e3va78kP4pHLLN5de
+E25E55vFV3+Tsyvyp1xb4uanSMOh5S7ID41/3DMmmvK3bA1zzqRUnBZOQpf
nHy+o+f+n5QfRXFDauzLf1xS7gFkTd4Z2FSrHE3uiXWl69c1naHdi9wbIz+L
DqT9/INyDAprclZ2r9TugztjTn2ZlnlR+TGU12xbsqtDjXJf8uNoGNL20qDP
q5VjyU9gv5Vc1OKIdj9yHObcF3axURdtmJZk8SRyzxw5P2pzlcrJoj/lZDEA
i+uHbqoq0jlZDKScLAYhemW/m/WrdE4WgykniyE4fSLpqwqfzsliKOVkMQxb
Gk146810nZNFPOVkMRzNDxRHRCbpnCxGUE4WI5ESNurCd8N1ThZPUU4Wo9C8
cVnc+3E6JwuvaZClF+VtyjvP66jskkWCaZBlAt55o6hdfXvdJ4vRpkGWoxG/
Niw/Olz3yWKMaZDlGLRxDvVa2BBUfbIYaxpkORY70nrIvF90nyzGmQZZjkPt
qsSVd5zRfbJINA2yTMShiL3L7ArdJ4vxpkGW4zF9UG7FoM91nywmmAZZTsD+
Q91Xdtij+2SRZBpkmYQ07HR7bNV9snjaNMjyaXyf82GflBd1nywmmgZZTkTW
iHYtV72g+2QxyTTI8pajDpYfXaD7ZJFsGmSZjLI3nOpPU3WfLJ4xDbJ8BouW
z4ldnKT7ZDHZNMhyMqIXFTY7F6/7ZGGbtsiwUd38lSvH+ynbZEl2yK6NNY/0
vntpN+UgWUwxbZExBafjwx/LjtD7ZEl2yO4UJA8vLa0I1/tkkWLaIiMFJ366
knGtsd4nS7JDdlOQODxseXX1BbVPFqmmLTJSsXzB5FeXuso2WZIdspuKVi1e
Od59vd4ni6mmLTKmovO2mQVFq/U+WZIdsjsVV95aunNHrt4nizTTFvnWv8FT
7tWejwzV+2RJdshuGrqu3l0W0Unvk0W6aYuMdMjKJrH3NNP7ZEl2yG46rrx6
Jj6m4bzaJ4sM0xYZGVg/P7/Lw98q22RJdshuBtovOVWVu1vvk8U00xYZ01A4
tmPx/nV6nyzJDtmdhtLI09cfna/3ySLTtEVGJv6o2le/KFXvkyXZIbuZePtg
xu6tffU+WWSZtsjIwoCyPasPtNL7ZEl2yG4Wfui3Ya3dTO+TRbZpi4xs1PbZ
/F5i3Tm1T5Zkh+xmw/PXhjePHVMOksV00xYZ02FlJXWzXtf7ZEl2yO50JC5Z
JMdKvU8WM0xbZMxA8X0RmT/P1/tkSXbI7gykb1vYf3CC3ieLmaYtMmbi12vP
JYR30/tkSXbI7kyceK324pf36H2ymGXaImMWVvc+Fllw+Xu1T5Zkh+zOQvr2
9IwHLioHycJn2kO2brnt7E8+3qscRQbZS7Z9uOPGpIakl5R9ZEn2kx0fKr+z
T+UtVC4hu+QAOejD2fNF57dPUg6RRY5pD9nKwaGyIa3Th+n7ySB7yXYOavdO
HRjXVt9PlmQ/2SGX5KCi62J7T91ZdT85QA6SQ2QxGytGJbxX86Oyh2yRo8gg
e8n2bBxs6fo3nVX2kSXZT3bIJWR3NiZsHF93M6DvJwfJIbLINe0hW+SoXPQ9
0qTDxGP6frKXbJN9ZEn2k51cVNZ2Loj/WN9PdskBcpAcIos80x6ylYdzqWdO
fn1A308G2Uu2yT6yJPvJTh6y5/kDlfv1/WSXHCAHySGyyDftIVv5KJgbnia1
o8gge8k22UeWZD/ZyUfhayd3Ddmn7ye75AA5SA6RxRzTHrJFjpqDyksj900q
0/eTvWSb7CNLsp/skEvILjlw63unVOdt+kDfTw6RxVzTHrJFjiKD7CXbZN9c
dMwvHdr8fX0/2U92yCVklxwgB8khsphn2vO//wUhE+Jz
      "]],
     FontFamily->"Arial"]}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0.4187990074692278},
  BaseStyle->{FontFamily -> "Arial"},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  Method->{
   "OptimizePlotMarkers" -> True, "OptimizePlotMarkers" -> True, 
    "CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        Identity[
         Part[#, 1]], 
        Identity[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        Identity[
         Part[#, 1]], 
        Identity[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 385.}, {0.4187990074692278, 0.6883490217810032}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.05], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Print",
 CellChangeTimes->{3.8726023265850983`*^9},
 CellLabel->
  "During evaluation of \
In[494]:=",ExpressionUUID->"ca6ea846-efdf-4829-82fa-46234af1b167"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["cost"], "Input",
 CellChangeTimes->{{3.8682011207542763`*^9, 3.868201121238194*^9}},
 CellLabel->
  "In[497]:=",ExpressionUUID->"810fdf0c-87d0-4a97-a1ef-37c4d61ce172"],

Cell[BoxData["0.43298585032774123`"], "Output",
 CellChangeTimes->{3.871443986991776*^9, 3.8726023277279797`*^9},
 CellLabel->
  "Out[497]=",ExpressionUUID->"fc30d2b4-3abb-4ebc-baf8-c4eee9ee1c8f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"i", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Association", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"i", "++"}], "->", "#"}], "&"}], "/@", 
   RowBox[{"Values", "@", "params"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.867831000090022*^9, 3.867831047698482*^9}, {
  3.8714440571204643`*^9, 3.8714440596457863`*^9}},
 CellLabel->
  "In[498]:=",ExpressionUUID->"e4c8f46b-3c45-44a9-9c96-c1f340f7efed"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"0", "\[Rule]", "0.9239537120590723`"}], ",", 
   RowBox[{"1", "\[Rule]", "0.9241761025557745`"}], ",", 
   RowBox[{"2", "\[Rule]", "0.9166807085341168`"}], ",", 
   RowBox[{"3", "\[Rule]", "0.9805456134451412`"}], ",", 
   RowBox[{"4", "\[Rule]", "0.9649648861853775`"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{
  3.867831011428205*^9, 3.867831048350876*^9, {3.867831384528637*^9, 
   3.867831388294718*^9}, 3.867831848309023*^9, 3.867832287290062*^9, 
   3.868007059200584*^9, {3.86800773917802*^9, 3.868007749554113*^9}, 
   3.868007892305319*^9, 3.868008451998466*^9, 3.868009022638466*^9, {
   3.868010097868264*^9, 3.8680101129489307`*^9}, 3.868079847373555*^9, 
   3.868083680864011*^9, 3.868085344751231*^9, 3.8680868473448687`*^9, 
   3.868087161111635*^9, 3.8713564604224777`*^9, 3.871442009676528*^9, 
   3.8714421425887947`*^9, 3.871443992016675*^9, 3.871444059991618*^9, 
   3.872602327748749*^9},
 CellLabel->
  "Out[499]=",ExpressionUUID->"bda1a52c-ef66-457c-822a-f82afdb29b51"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"bellcost", "[", "params", "]"}]], "Input",
 CellChangeTimes->{{3.86807975157582*^9, 3.868079753069673*^9}, {
  3.868086624139592*^9, 3.868086625708959*^9}},
 CellLabel->
  "In[500]:=",ExpressionUUID->"0cab19b4-cd6f-4a36-a845-d3eaa8492b83"],

Cell[BoxData["0.43298585032774123`"], "Output",
 CellChangeTimes->{
  3.867829821204117*^9, 3.86782988547309*^9, 3.867829984025478*^9, 
   3.867830150847775*^9, 3.8678303137825327`*^9, {3.867830345808468*^9, 
   3.8678303484788933`*^9}, {3.867830971233819*^9, 3.867830988252862*^9}, {
   3.8678313846320047`*^9, 3.8678313892694902`*^9}, {3.867831848438449*^9, 
   3.86783186322208*^9}, 3.867831968379147*^9, 3.867832288355042*^9, 
   3.868007062411025*^9, {3.868007739289916*^9, 3.868007753139139*^9}, 
   3.868008452058819*^9, 3.868009022652688*^9, 3.868009073386723*^9, {
   3.868010099808971*^9, 3.868010115005505*^9}, {3.868010181343219*^9, 
   3.868010188541646*^9}, 3.8680797537125273`*^9, 3.86807984750747*^9, 
   3.868083681014669*^9, 3.868083839353265*^9, 3.868083919433448*^9, 
   3.868085344882468*^9, 3.868087161275325*^9, {3.871347562494996*^9, 
   3.871347566213564*^9}, 3.871356461188591*^9, 3.8714420104262047`*^9, 
   3.8714421450949306`*^9, 3.871443995853647*^9, 3.8726023284541683`*^9},
 CellLabel->
  "Out[500]=",ExpressionUUID->"020d4c84-11d0-483c-bc44-e7de8fb4a6d7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"fids", "[", "params_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "init", ",", "qubits", ",", "plot", ",", "codes", ",", "fidtarget", ",", 
      "opt", ",", "dev", ",", "noisycirc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"codes", "=", 
      RowBox[{"ReplaceList", "[", 
       RowBox[{
        RowBox[{"Sort", "@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "5"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p___", ",", "a_", ",", "b_", ",", "q___"}], "}"}], ":>", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}], ",", "\"\<\>\""}], "]"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"opt", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"FidCZ", "\[Rule]", 
         RowBox[{"\[LeftAssociation]", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            SubscriptBox["\[Theta]", "0"]}], ",", 
           RowBox[{"1", "\[Rule]", 
            SubscriptBox["\[Theta]", "1"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            SubscriptBox["\[Theta]", "2"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            SubscriptBox["\[Theta]", "3"]}], ",", 
           RowBox[{"4", "\[Rule]", 
            SubscriptBox["\[Theta]", "4"]}]}], "\[RightAssociation]"}]}], 
        "}"}], "/.", "params"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dev", "=", 
      RowBox[{"SiliconDelft", "[", 
       RowBox[{"Sequence", "@@", "opt"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"init", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"qubits", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"StringSplit", "[", 
           RowBox[{"code", ",", "\"\<\>\""}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"Intersection", "[", 
             RowBox[{"qubits", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ">", 
           "0"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"init", ",", 
            SubscriptBox["Init", 
             RowBox[{"0", ",", "1", ",", "2"}]]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"Intersection", "[", 
             RowBox[{"qubits", ",", 
              RowBox[{"{", 
               RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "]"}]}], ">", 
           "0"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"init", ",", 
            SubscriptBox["Init", 
             RowBox[{"3", ",", "4", ",", "5"}]]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetQuregMatrix", "[", 
         RowBox[{"\[Rho]", ",", 
          RowBox[{"RandomChoice", "@", "\[Rho]mat"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"noisycirc", "=", 
         RowBox[{"ExtractCircuit", "@", 
          RowBox[{"GetNoisyForm", "[", 
           RowBox[{
            RowBox[{"Flatten", "@", 
             RowBox[{"{", 
              RowBox[{"init", ",", 
               RowBox[{"bellcirc\[Rho]", "[", "code", "]"}]}], "}"}]}], ",", 
            RowBox[{"SiliconDelft", "[", 
             RowBox[{"Sequence", "@@", "opt"}], "]"}], ",", " ", 
            RowBox[{"ReplaceAliases", "->", "True"}], ",", " ", 
            RowBox[{"Parallel", "->", 
             RowBox[{"conf", "[", "\"\<parallel\>\"", "]"}]}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"noisycirc", "=", 
         RowBox[{"SimplifyCircuit", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"noisycirc", ",", 
              RowBox[{
               SubscriptBox["Depol", "__"], "[", "0.", "]"}]}], "]"}], ",", 
            RowBox[{
             SubscriptBox["Deph", "__"], "[", "0.", "]"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"ApplyCircuit", "[", 
         RowBox[{"\[Rho]", ",", "noisycirc"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetQuregMatrix", "[", 
         RowBox[{"\[Rho]2", ",", 
          RowBox[{"PartialTrace", "[", 
           RowBox[{"\[Rho]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"Complement", "[", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"0", ",", "5"}], "]"}], ",", "qubits"}], "]"}]}]}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ApplyCircuit", "[", 
         RowBox[{
          RowBox[{"InitZeroState", "@", "\[Psi]2"}], ",", 
          RowBox[{"bellcirc\[Psi]", "[", "code", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"CalcFidelity", "[", 
            RowBox[{"\[Rho]2", ",", "\[Psi]2"}], "]"}], "*", "100"}], ",", 
          RowBox[{
           RowBox[{"concurence", "[", "\[Rho]2", "]"}], "*", "100"}]}], 
         "}"}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"code", ",", "codes"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.867740950405389*^9, 3.867740964340288*^9}, {
   3.86774868361053*^9, 3.8677487053141003`*^9}, {3.86775451511749*^9, 
   3.86775451925145*^9}, {3.8678284294771*^9, 3.8678284427981167`*^9}, {
   3.867828492470105*^9, 3.867828519124596*^9}, {3.8678287488241463`*^9, 
   3.8678287664650784`*^9}, {3.867829074144292*^9, 3.867829099034978*^9}, {
   3.867829134889765*^9, 3.867829210210071*^9}, {3.8678293439555473`*^9, 
   3.867829347357991*^9}, {3.867829402223761*^9, 3.8678294443859043`*^9}, {
   3.867829487854457*^9, 3.867829488073903*^9}, 3.867830791481938*^9, {
   3.867831858320448*^9, 3.8678318607548847`*^9}, {3.868006189003784*^9, 
   3.8680062061138773`*^9}, {3.868008391912711*^9, 3.868008393128044*^9}, {
   3.868009042835994*^9, 3.868009070991314*^9}, 3.8680095351469307`*^9, 
   3.868010185655253*^9, 3.8680797316193867`*^9, {3.871347584444983*^9, 
   3.871347596255004*^9}, 3.8714421613208647`*^9},
 CellLabel->
  "In[501]:=",ExpressionUUID->"51f33504-12f1-421a-afbe-b5e4fb54c3c1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"fids", "[", "params", "]"}]], "Input",
 CellChangeTimes->{{3.8680797347651863`*^9, 3.86807973638686*^9}},
 CellLabel->
  "In[502]:=",ExpressionUUID->"73d3a447-74ac-419d-b8de-055eb9df9414"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"88.77429684466291`", ",", "78.52390412329547`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"89.65444437601543`", ",", "79.39898987390396`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"88.29111265247343`", ",", "78.31591159255281`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"95.12721972867826`", ",", "93.16223363200056`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"93.6429103907711`", ",", "89.32989555051395`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.868079737008864*^9, 3.868079745037704*^9}, 
   3.8680798476319027`*^9, 3.868083681151545*^9, 3.868085345150474*^9, 
   3.868087161514423*^9, 3.8713475687956543`*^9, 3.871356487926304*^9, 
   3.871442035966674*^9, 3.871442164606838*^9, 3.8714440005827923`*^9, 
   3.87260232923098*^9},
 CellLabel->
  "Out[502]=",ExpressionUUID->"aa2a6f8b-9abf-43eb-a880-3c6b0d32cf99"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1295, 809},
WindowMargins->{{0.5, Automatic}, {Automatic, 0.5}},
Magnification:>0.9 Inherited,
FrontEndVersion->"13.1 for Linux x86 (64-bit) (June 16, 2022)",
StyleDefinitions->FrontEnd`FileName[{"Report"}, "StandardReport.nb", 
  CharacterEncoding -> "UTF-8"],
ExpressionUUID->"87ad5eff-123e-4fd1-8093-497e43aaa63c"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 173, 3, 92, "Section",ExpressionUUID->"e5abd4bc-7410-43a7-b0e4-f4a71b06d082"],
Cell[756, 27, 211, 5, 54, "Input",ExpressionUUID->"9c142616-efba-4462-b026-531604d75a29"],
Cell[970, 34, 206, 5, 54, "Input",ExpressionUUID->"7164f137-e180-411b-9f7c-f6c32df31320"],
Cell[1179, 41, 1496, 25, 82, "Input",ExpressionUUID->"bdc5fccf-12ea-488c-ae86-ace93b7013bd"],
Cell[2678, 68, 1226, 18, 54, "Input",ExpressionUUID->"e6fc824d-13a0-4e4f-8d13-9693c655ca12"],
Cell[3907, 88, 10793, 259, 1231, "Input",ExpressionUUID->"a071e88b-5fbc-4f67-889f-f6f2c5755a29"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14737, 352, 335, 5, 92, "Section",ExpressionUUID->"ba65ad1f-db69-4b88-a423-9e4fb1904099"],
Cell[15075, 359, 14196, 318, 2770, "Input",ExpressionUUID->"ef82f5a6-d38a-4a59-bc34-a43b7cc6249d"]
}, Closed]],
Cell[CellGroupData[{
Cell[29308, 682, 167, 3, 71, "Section",ExpressionUUID->"e1dce9e3-e9ed-4283-a8bf-cbaff7e3156e"],
Cell[29478, 687, 1114, 23, 161, "Input",ExpressionUUID->"667100a4-5af5-4c5b-a049-871185f7cf10"],
Cell[30595, 712, 5512, 166, 215, "Input",ExpressionUUID->"96708743-8d4c-4525-a3a0-0595b1ce61d6"],
Cell[36110, 880, 669, 18, 159, "Input",ExpressionUUID->"194bd8c7-599e-4170-8584-307678b273b5"],
Cell[36782, 900, 13737, 307, 1151, "Input",ExpressionUUID->"97c263b8-b0a9-47ff-9911-a89e83bfdb24"],
Cell[50522, 1209, 1490, 39, 328, "Input",ExpressionUUID->"05e29458-cdfa-40ad-afbf-a9583e507ded"],
Cell[52015, 1250, 894, 22, 74, "Input",ExpressionUUID->"6a509c95-ab7a-48ef-8e0c-d7206d661fb7"],
Cell[CellGroupData[{
Cell[52934, 1276, 5421, 88, 413, "Input",ExpressionUUID->"d97f39dd-75da-4c67-92ba-152bd68f8908"],
Cell[CellGroupData[{
Cell[58380, 1368, 232, 5, 32, "Print",ExpressionUUID->"b0151009-67b3-47b9-b525-d604be4eceb8"],
Cell[58615, 1375, 3591, 77, 306, "Print",ExpressionUUID->"ca6ea846-efdf-4829-82fa-46234af1b167"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[62255, 1458, 181, 3, 74, "Input",ExpressionUUID->"810fdf0c-87d0-4a97-a1ef-37c4d61ce172"],
Cell[62439, 1463, 196, 3, 74, "Output",ExpressionUUID->"fc30d2b4-3abb-4ebc-baf8-c4eee9ee1c8f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62672, 1471, 461, 12, 103, "Input",ExpressionUUID->"e4c8f46b-3c45-44a9-9c96-c1f340f7efed"],
Cell[63136, 1485, 1082, 20, 74, "Output",ExpressionUUID->"bda1a52c-ef66-457c-822a-f82afdb29b51"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64255, 1510, 263, 5, 74, "Input",ExpressionUUID->"0cab19b4-cd6f-4a36-a845-d3eaa8492b83"],
Cell[64521, 1517, 1088, 16, 74, "Output",ExpressionUUID->"020d4c84-11d0-483c-bc44-e7de8fb4a6d7"]
}, Open  ]],
Cell[65624, 1536, 6550, 155, 604, "Input",ExpressionUUID->"51f33504-12f1-421a-afbe-b5e4fb54c3c1"],
Cell[CellGroupData[{
Cell[72199, 1695, 212, 4, 73, "Input",ExpressionUUID->"73d3a447-74ac-419d-b8de-055eb9df9414"],
Cell[72414, 1701, 910, 20, 73, "Output",ExpressionUUID->"aa2a6f8b-9abf-43eb-a880-3c6b0d32cf99"]
}, Open  ]]
}, Open  ]]
}
]
*)

